# Upgrading from 8.x to 9.x

## Get new assets, clear cache

This is true for every update: be sure to grab the latest assets and to clear the view cache:

```bash
php artisan vendor:publish --provider="Code16\Sharp\SharpServiceProvider" --tag=assets
php artisan view:clear
```

## Config is now required for custom menu / login images

If you have added `/public/sharp-assets/menu-icon.png` and/or `/public/sharp-assets/login-icon.png` images, you must ensure the path is defined in the `config/sharp.php` config file:
```php
// config/sharp.php

return [
    // [...]
    
    'theme' => [
        'primary_color' => ...,
        'logo_urls' => [
            'menu' => '/public/sharp-assets/menu-icon.png',
            'login' => '/public/sharp-assets/login-icon.png',
        ],
    ],
];
```

## New middlewares

Due to migration to inertia, two middlewares must be added to the `sharp.middleware.web` config:

```php
// config/sharp.php

return [
    'middleware' => [
        //...
        'web' => [
            // ...
            \Code16\Sharp\Http\Middleware\HandleSharpErrors::class,
            \Code16\Sharp\Http\Middleware\HandleInertiaRequests::class,
        ],
    ],
]
```

## New validation system

The validation system was odd, for legacy reasons. 
In 9.x, it has been rewritten to be in phase with Laravel and to be more consistent:

- validation rules can now be defined in a `rules()` method of the form / command class,
- or with a `->validate($data, $rules)` call before update / store.
- The `$formValidatorClass` property usage, in a `SharpForm`, is now deprecated (you are strongly encouraged to migrate to the `rules()` method instead).

This version brings two huge benefits (besides the fact that it's clearer):

- the "delayed creation" thing is gone: the `{id}` parameter in a `SharpFormUploadField` storageBasePath isn't anymore an issue in creation case as Sharp will no longer call the `update()` method twice.
- Validation is now called AFTER data formatters, even in `SharpForm` (it was already the case with `Command`).

Breaking changes: the 8.x and below validation is still allowed, but deprecated. If you decide to migrate (and you should), pay attention to:

- remove special workarounds you may have done to handle the "delayed creation" thing,
- remove the `.text` suffix you may have added for `SharpFormEditorField` validation rules.

