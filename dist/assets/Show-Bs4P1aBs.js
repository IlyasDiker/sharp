import{d as Z,ak as T,aS as fe,o as a,A as u,q as me,ax as he,ay as pe,r as b,aT as ee,J as ne,y as ie,az as ye,aA as oe,aU as _e,aV as ge,aW as A,a as o,w as n,j as w,u as e,Q as re,b as F,t as k,c as h,k as E,aX as de,i as g,v as be,aY as ve,aR as we,aB as ke,V as W,aC as $e,H as C,F as _,aZ as D,a_ as Ce,a$ as Se,aJ as J,aK as X,_ as U,aL as Y,Y as ze,b0 as te,B as Re,b1 as Fe,G as Be,I as Ie,b2 as Ve,b3 as Ke,b4 as Le,b5 as xe,b6 as Ue,b7 as ae,b8 as Ee,X as Te,S as Ae,aN as qe,b9 as je,ba as He,bb as Pe,bc as N,bd as De,be as Ne,aM as Ge}from"./sharp-NGr8F9Yr.js";import{c as Oe,a as se,b as le,p as Qe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-8PAKNJqz.js";import{E as We,_ as Je,u as Xe,a as M}from"./useEntityListHighlightedItem-D4HE1h2r.js";import{_ as Ye}from"./Title.vue_vue_type_script_setup_true_lang-tYLV-bre.js";import{_ as Me}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BA6cFe6u.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-CeHCPQ3T.js";const Ze=Z({__name:"Section",props:{section:{}},setup(S){const i=T(S.section.collapsable),l=fe({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(t,d)=>(a(),u("section",null,[me(t.$slots,"default",he(pe(l)))]))}});class et{constructor(s,i,l){Object.assign(this,s),this.entityKey=i,this.instanceId=l}get formUrl(){return b().params.instanceId?b("code16.sharp.form.edit",{parentUri:ee(),entityKey:this.entityKey,instanceId:this.instanceId}):b("code16.sharp.form.create",{parentUri:ee(),entityKey:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var s;return(s=this.config.state)==null?void 0:s.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var s,i;return(i=(s=this.config.commands)==null?void 0:s.instance)==null?void 0:i.map(l=>l.filter(t=>t.authorization))}getTitle(s){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[s]:this.title:null}sectionFields(s){return s.columns.map(i=>i.fields.flat().map(l=>this.fields[l.key])).flat().filter(Boolean)}sectionHasField(s,i){return this.sectionFields(s).some(l=>l.type===i)}sectionCommands(s){return s.key?(this.config.commands[s.key]??[]).map(i=>i.filter(l=>l.authorization)):null}sectionShouldBeVisible(s,i){return s.columns.map(l=>l.fields).flat(2).some(l=>this.fieldShouldBeVisible(l,i))}fieldRowShouldBeVisible(s,i,l=this.fields,t=this.data){return s.some(d=>this.fieldShouldBeVisible(d,i,l,t))}fieldShouldBeVisible(s,i,l=this.fields,t=this.data){var B;const d=l[s.key];if(!d)return ne("app.debug");if(d.type==="entityList"||d.emptyVisible)return!0;if(d.type==="text"){const p=t[d.key];return d.localized?!!((B=p==null?void 0:p.text)!=null&&B[i]):!!(p!=null&&p.text)}if(d.type==="list"){const p=t[d.key];return(p==null?void 0:p.length)>0}return!!t[d.key]}}function tt(){const S=T({}),s=ie(()=>Object.values(S.value).some(l=>l));function i(l,t){S.value[l]=t}return{isReordering:s,onEntityListReordering:i}}const at={class:"flex items-center gap-x-4"},st=Z({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{}},setup(S){const s=S,i=T(),l=T(s.collapsable&&!s.highlightedInstanceId),t=T(null),d=ye(),B=oe("entityList",{reload:(r,{formModal:c})=>{I(),c.shouldReopen&&c.reopen()},refresh:(r,{formModal:c})=>{t.value=t.value.withRefreshedItems(r.items),c.shouldReopen&&c.reopen()}}),p=_e({data:null,collapsed:l.value},`entityList_${s.field.key}`);p.value.data&&!l.value&&V(p.value.data),!ge()&&!l.value&&I();async function I(){const r=await A.get(s.field.endpointUrl,{fetchOptions:{cache:"no-store"}}).then(c=>c.data);V(r)}function V(r){t.value=new We(r,s.field.entityListKey,s.field.hiddenFilters,s.field.hiddenCommands),d.update(r.config.filters,r.filterValues),p.value.data=r}async function G(r){const c=await A.get(b("code16.sharp.api.list",{entityKey:s.field.entityListKey}),{params:r}).then(y=>y.data);V(c)}async function O(r,c){const y=await A.post(b("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:t.value.query,filterValues:d.nextValues(r,c),hiddenFilters:s.field.hiddenFilters}).then(v=>v.data);V(y)}async function q(){const r=await A.post(b("code16.sharp.api.list.filters.store",{entityKey:s.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:s.field.hiddenFilters}).then(c=>c.data);V(r)}function j(){l.value=!l.value,p.value.collapsed=l.value,t.value||I()}return(r,c)=>(a(),u("div",{ref_key:"el",ref:i},[o(Je,be({"entity-list":t.value,"entity-key":r.field.entityListKey,filters:e(d),commands:e(B),"show-create-button":r.field.showCreateButton,"show-reorder-button":r.field.showReorderButton,"show-search-field":r.field.showSearchField,"show-entity-state":r.field.showEntityState,"highlighted-instance-id":r.highlightedInstanceId,collapsed:l.value,title:r.field.label,inline:"","onUpdate:query":G,onFilterChange:O,onReset:q,onReordering:c[0]||(c[0]=y=>r.$emit("reordering",y))},r.$attrs),{"card-header":n(()=>[w("div",at,[o(e(re),{class:"line-clamp-2"},{default:n(()=>[F(k(r.field.label),1)]),_:1}),r.collapsable?(a(),h(e(E),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:n(()=>[o(e(de),{class:"w-4 h-4"})]),_:1})):g("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),lt={class:"@container"},nt={key:0,class:"container"},it={class:"grid gap-6 @3xl:gap-10"},ot={class:"font-mono"},rt={class:"flex flex-wrap gap-4"},dt={class:"flex gap-4"},ut={class:"truncate"},ct={class:"uppercase text-xs"},ft={key:2,class:"flex gap-3"},mt={class:"truncate"},ht={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},wt=Z({__name:"Show",props:{show:{},breadcrumb:{}},setup(S){var c;const s=S,{entityKey:i,instanceId:l}=b().params,t=new et(s.show,i,l),d=T((c=t.locales)==null?void 0:c[0]),{isReordering:B,onEntityListReordering:p}=tt(),I=oe("show"),{highlightedEntityKey:V,highlightedInstanceId:G}=Xe();ve("show",t);const O=ie(()=>{var y;return t.layout.sections[0]&&(t.sectionHasField(t.layout.sections[0],"entityList")||t.layout.sections[0].title||(y=t.sectionCommands(t.layout.sections[0]))!=null&&y.flat().length)||!t.layout.sections.length?[{key:null,title:"",collapsable:!1,columns:[]},...t.layout.sections]:t.layout.sections});function q(y){I.send(y,{postCommand:b("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:l,commandKey:y.key}),getForm:l?b("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:l,commandKey:y.key}):b("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:y.key}),entityKey:i,instanceId:l,query:Qe(location.search)})}function j(y){A.post(b("code16.sharp.api.show.state",{entityKey:i,instanceId:l}),{value:y}).then(v=>{I.handleCommandResponse(v.data)}).catch(v=>{var f,K;const Q=(f=v.response)==null?void 0:f.data;((K=v.response)==null?void 0:K.status)===422&&De(Q.message,{title:U("sharp::modals.state.422.title"),isError:!0})})}async function r(){await Ne(t.config.deleteConfirmationText)&&Ge.delete(b("code16.sharp.show.delete",{parentUri:b().params.parentUri,entityKey:i,instanceId:l}))}return(y,v)=>{const Q=we("SharpShowField");return a(),h(ke,null,{breadcrumb:n(()=>[e(ne)("sharp.display_breadcrumb")?(a(),h(Me,{key:0,breadcrumb:y.breadcrumb},null,8,["breadcrumb"])):g("",!0)]),default:n(()=>[o(Ye,{breadcrumb:y.breadcrumb},null,8,["breadcrumb"]),o(Oe,{commands:e(I)},{default:n(()=>[w("div",lt,[w("div",{class:W(e(t).pageAlert?"pt-4":"pt-6 @3xl:pt-10")},[e(t).pageAlert?(a(),u("div",nt,[o($e,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):g("",!0),w("div",it,[(a(!0),u(_,null,C(O.value,(f,K)=>D((a(),h(Ze,{class:"min-w-0",section:f},{default:n(({collapsed:H,onCollapseToggle:ue})=>[e(t).sectionHasField(f,"entityList")?(a(!0),u(_,{key:0},C(f.columns,P=>(a(),u(_,null,[(a(!0),u(_,null,C(P.fields,L=>(a(),u(_,null,[(a(!0),u(_,null,C(L,$=>(a(),u(_,null,[e(t).fields[$.key]?(a(),h(st,{key:0,field:e(t).fields[$.key],collapsable:f.collapsable,value:null,"highlighted-instance-id":e(V)===e(t).fields[$.key].entityListKey?e(G):null,onReordering:R=>e(p)($.key,R)},null,8,["field","collapsable","highlighted-instance-id","onReordering"])):(a(),u(_,{key:1},[v[1]||(v[1]=F(" Undefined EntityList ")),w("span",ot,k($.key),1)],64))],64))),256))],64))),256))],64))),256)):(a(),h(Ce,{key:1},{default:n(()=>{var P;return[f.title||K==0||f.collapsable||(P=e(t).sectionCommands(f))!=null&&P.flat().length?(a(),h(Se,{key:0,class:"data-[overflowing-viewport]:sticky",collapsed:H},{default:n(()=>{var L,$,R,z;return[w("div",rt,[w("div",dt,[f.title||K==0&&e(t).getTitle(d.value)?(a(),h(e(re),{key:0,innerHTML:f.title||K==0&&e(t).getTitle(d.value)},null,8,["innerHTML"])):g("",!0),f.collapsable?(a(),h(e(E),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:ue},{default:n(()=>[o(e(de),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):g("",!0)]),(L=e(t).sectionCommands(f))!=null&&L.flat().length?(a(),u("div",{key:0,class:W(["ml-auto flex -my-1 justify-end",{invisible:H}])},[o(e(J),null,{default:n(()=>[o(e(X),{"as-child":""},{default:n(()=>[o(e(E),{class:"h-8",size:"sm",variant:"outline"},{default:n(()=>[F(k(e(U)("sharp::entity_list.commands.instance.label"))+" ",1),o(se)]),_:1})]),_:1}),o(e(Y),null,{default:n(()=>[o(le,{commands:e(t).sectionCommands(f),onSelect:q},null,8,["commands"])]),_:2},1024)]),_:2},1024)],2)):g("",!0),K==0?(a(),u("div",{key:1,class:W(["ml-auto flex flex-wrap -my-1 justify-end gap-3",{invisible:H}])},[e(t).config.state?(a(),h(e(J),{key:0},{default:n(()=>[o(e(X),{"as-child":""},{default:n(()=>[o(e(E),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization},{default:n(()=>[o(e(ze),{variant:"outline"},{default:n(()=>{var m;return[o(M,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),F(" "+k((m=e(t).instanceStateValue)==null?void 0:m.label),1)]}),_:1})]),_:1},8,["disabled"])]),_:1}),o(e(Y),null,{default:n(()=>[(a(!0),u(_,null,C(e(t).config.state.values,m=>(a(),h(e(te),{key:m.value,"model-value":m.value===e(t).instanceState,"onUpdate:modelValue":x=>x&&j(m.value)},{default:n(()=>[o(M,{class:"mr-1.5","state-value":m},null,8,["state-value"]),w("span",ut,k(m.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):g("",!0),($=e(t).locales)!=null&&$.length?(a(),h(e(Re),{key:1,modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=m=>d.value=m)},{default:n(()=>[o(Fe,{class:"pointer-events-auto mr-auto"}),o(e(Be),null,{default:n(()=>[(a(!0),u(_,null,C(e(t).locales,m=>(a(),h(e(Ie),{key:m,value:m},{default:n(()=>[w("span",ct,k(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):g("",!0),(R=e(t).allowedInstanceCommands)!=null&&R.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization||e(t).authorizations.update?(a(),u("div",ft,[(z=e(t).allowedInstanceCommands)!=null&&z.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization?(a(),h(e(J),{key:0},{default:n(()=>[o(e(X),{"as-child":""},{default:n(()=>[o(e(E),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:n(()=>[F(k(e(U)("sharp::entity_list.commands.instance.label"))+" ",1),o(se)]),_:1})]),_:1}),o(e(Y),null,{default:n(()=>{var m;return[e(t).config.state&&e(t).config.state.authorization?(a(),u(_,{key:0},[o(e(Ve),null,{default:n(()=>[o(e(Ke),null,{default:n(()=>[o(e(Le),null,{default:n(()=>[F(k(e(U)("sharp::modals.entity_state.edit.title")),1)]),_:1}),o(e(xe),null,{default:n(()=>[o(e(Ue),null,{default:n(()=>[(a(!0),u(_,null,C(e(t).config.state.values,x=>(a(),h(e(te),{key:x.value,"model-value":x.value===e(t).instanceState,"onUpdate:modelValue":ce=>ce&&j(x.value)},{default:n(()=>[o(M,{class:"mr-1.5","state-value":x},null,8,["state-value"]),w("span",mt,k(x.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),o(e(ae),{class:"last:hidden"})],64)):g("",!0),o(le,{commands:e(t).allowedInstanceCommands,onSelect:q},null,8,["commands"]),e(t).authorizations.delete?(a(),u(_,{key:1},[(m=e(t).allowedInstanceCommands)!=null&&m.flat().length?(a(),h(e(ae),{key:0})):g("",!0),o(e(Ee),{class:"text-destructive",onClick:r},{default:n(()=>[F(k(e(U)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):g("",!0)]}),_:1})]),_:1})):g("",!0),e(t).authorizations.update?(a(),h(e(E),{key:1,class:"h-8 pointer-events-auto",size:"sm",disabled:e(B),"as-child":""},{default:n(()=>[o(e(Te),{as:e(B)?"button":"a",href:e(t).formUrl},{default:n(()=>[F(k(s.show.config.editButtonLabel||e(U)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):g("",!0)])):g("",!0)],2)):g("",!0)])]}),_:2},1032,["collapsed"])):g("",!0),D(o(e(Ae),null,{default:n(()=>[w("div",ht,[(a(!0),u(_,null,C(f.columns,(L,$)=>(a(),u("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:qe({"--size":`${L.size}`})},[o(je,{class:"gap-x-4 gap-y-6"},{default:n(()=>[(a(!0),u(_,null,C(L.fields,R=>D((a(),h(He,null,{default:n(()=>[(a(!0),u(_,null,C(R,z=>D((a(),h(Pe,{layout:z},{default:n(()=>[o(Q,{field:e(t).fields[z.key],"field-layout":z,value:e(t).data[z.key],locale:d.value,collapsable:f.collapsable,"entity-key":e(i),"instance-id":e(l),"is-right-col":$===f.columns.length-1,row:R,onReordering:m=>e(p)(z.key,m)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[N,e(t).fieldShouldBeVisible(z,d.value)]])),256))]),_:2},1536)),[[N,e(t).fieldRowShouldBeVisible(R,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[N,!H]])]}),_:2},1024))]),_:2},1032,["section"])),[[N,e(t).sectionShouldBeVisible(f,d.value)]])),256))])],2)])]),_:1},8,["commands"])]),_:1})}}});export{wt as default};
