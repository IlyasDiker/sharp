import{d as ee,ak as I,aQ as fe,o as l,A as c,q as me,ax as he,ay as pe,r as v,aR as te,J as re,y as ye,az as _e,aA as de,aS as ge,aT as be,aU as E,a as n,w as s,j as $,u as e,Q as Z,b as B,t as k,c as m,k as x,aV as ue,i as g,v as ve,aW as ke,aP as we,aB as $e,aX as Se,V as ae,B as Ce,aY as Re,G as ze,H as w,F as y,aJ as J,aK as W,Y as Be,aL as X,_ as T,aZ as Ke,a_ as Fe,a$ as Ve,b0 as Ie,b1 as Le,b2 as se,b3 as Ue,X as Te,aC as xe,b4 as le,R as Y,b5 as Ee,aM as Ae,I as je,b6 as ne,b7 as N,S as qe,aN as Pe,b8 as He,b9 as Ne,ba as De,bb as D,bc as Qe}from"./sharp-CVs8CQK9.js";import{a as ie,b as oe,c as Ge,p as Oe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-B66lu-av.js";import{E as Je,_ as We,u as Xe,a as M}from"./useEntityListHighlightedItem-CXDaGrNo.js";import{_ as Ye}from"./Title.vue_vue_type_script_setup_true_lang-BfrYVsXh.js";import{_ as Me}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-TRBHJ9GF.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-DDWzFIgG.js";const Ze=ee({__name:"Section",props:{section:{}},setup(S){const o=I(S.section.collapsable),i=fe({collapsed:o,onCollapseToggle(){o.value=!o.value}});return(t,r)=>(l(),c("section",null,[me(t.$slots,"default",he(pe(i)))]))}});class et{constructor(a,o,i){Object.assign(this,a),this.entityKey=o,this.instanceId=i}get formUrl(){const a=this.config.multiformAttribute?this.data[this.config.multiformAttribute]:null;return v().params.instanceId?v("code16.sharp.form.edit",{parentUri:te(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey,instanceId:this.instanceId}):v("code16.sharp.form.create",{parentUri:te(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var a;return(a=this.config.state)==null?void 0:a.values.find(o=>o.value===this.instanceState)}get allowedInstanceCommands(){var a,o;return(o=(a=this.config.commands)==null?void 0:a.instance)==null?void 0:o.map(i=>i.filter(t=>t.authorization))}getTitle(a){var o;return this.title?typeof this.title=="object"?(o=this.title)==null?void 0:o[a]:this.title:null}sectionFields(a){return a.columns.map(o=>o.fields.flat().map(i=>this.fields[i.key])).flat().filter(Boolean)}sectionHasField(a,o){return this.sectionFields(a).some(i=>i.type===o)}sectionCommands(a){return a.key?(this.config.commands[a.key]??[]).map(o=>o.filter(i=>i.authorization)):null}sectionShouldBeVisible(a,o){return a.columns.map(i=>i.fields).flat(2).some(i=>this.fieldShouldBeVisible(i,o))}fieldRowShouldBeVisible(a,o,i=this.fields,t=this.data){return a.some(r=>this.fieldShouldBeVisible(r,o,i,t))}fieldShouldBeVisible(a,o,i=this.fields,t=this.data){var K;const r=i[a.key];if(!r)return re("app.debug");if(r.type==="entityList"||r.emptyVisible)return!0;if(r.type==="text"){const p=t[r.key];return r.localized?!!((K=p==null?void 0:p.text)!=null&&K[o]):!!(p!=null&&p.text)}if(r.type==="list"){const p=t[r.key];return(p==null?void 0:p.length)>0}return!!t[r.key]}}function tt(){const S=I({}),a=ye(()=>Object.values(S.value).some(i=>i));function o(i,t){S.value[i]=t}return{isReordering:a,onEntityListReordering:o}}const at={class:"flex items-center gap-x-4"},st=ee({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{},highlightedInstanceId:{}},setup(S){const a=S,o=I(),i=I(a.collapsable&&!a.highlightedInstanceId),t=I(null),r=_e(),K=de("entityList",{reload:(d,{formModal:h})=>{L(),h.shouldReopen&&h.reopen()},refresh:(d,{formModal:h})=>{t.value=t.value.withRefreshedItems(d.items),h.shouldReopen&&h.reopen()}}),p=ge({data:null,collapsed:i.value},`entityList_${a.field.key}`);p.value.data&&!i.value&&C(p.value.data),!be()&&!i.value&&L();async function L(){const d=await E.get(a.field.endpointUrl,{fetchOptions:{cache:"no-store"}}).then(h=>h.data);C(d)}function C(d){t.value=new Je(d,a.field.entityListKey,a.field.hiddenFilters,a.field.hiddenCommands),r.update(d.config.filters,d.filterValues),p.value.data=d}async function Q(d){const h=await E.get(v("code16.sharp.api.list",{entityKey:a.field.entityListKey}),{params:d}).then(_=>_.data);C(h)}async function G(d,h){const _=await E.post(v("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:t.value.query,filterValues:r.nextValues(d,h),hiddenFilters:a.field.hiddenFilters}).then(b=>b.data);C(_)}async function A(){const d=await E.post(v("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:r.defaultValues(r.rootFilters),hiddenFilters:a.field.hiddenFilters}).then(h=>h.data);C(d)}function j(){i.value=!i.value,p.value.collapsed=i.value,t.value||L()}return(d,h)=>(l(),c("div",{ref_key:"el",ref:o},[n(We,ve({"entity-list":t.value,"entity-key":d.field.entityListKey,filters:e(r),commands:e(K),"show-create-button":d.field.showCreateButton,"show-reorder-button":d.field.showReorderButton,"show-search-field":d.field.showSearchField,"show-entity-state":d.field.showEntityState,"highlighted-instance-id":d.highlightedInstanceId,collapsed:i.value,title:d.field.label,inline:"","onUpdate:query":Q,onFilterChange:G,onReset:A,onReordering:h[0]||(h[0]=_=>d.$emit("reordering",_))},d.$attrs),{"card-header":s(()=>[$("div",at,[n(e(Z),null,{default:s(()=>[B(k(d.field.label),1)]),_:1}),d.collapsable?(l(),m(e(x),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:s(()=>[n(e(ue),{class:"w-4 h-4"})]),_:1})):g("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","highlighted-instance-id","collapsed","title"])],512))}}),lt={class:"flex flex-wrap justify-end gap-3"},nt={class:"uppercase text-xs"},it={class:"contents lg:flex flex-wrap justify-end gap-3","data-sticky-content":""},ot={class:"truncate"},rt={class:"truncate"},dt={key:0,class:"container"},ut={class:"grid gap-6 md:gap-8"},ct={class:"font-mono"},ft={class:"flex gap-4"},mt={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},vt=ee({__name:"Show",props:{show:{},breadcrumb:{}},setup(S){var h;const a=S,{entityKey:o,instanceId:i}=v().params,t=new et(a.show,o,i),r=I((h=t.locales)==null?void 0:h[0]),{isReordering:K,onEntityListReordering:p}=tt(),L=I(!1),C=de("show"),{highlightedEntityKey:Q,highlightedInstanceId:G}=Xe();ke("show",t);function A(_){C.send(_,{postCommand:v("code16.sharp.api.show.command.instance",{entityKey:o,instanceId:i,commandKey:_.key}),getForm:i?v("code16.sharp.api.show.command.instance.form",{entityKey:o,instanceId:i,commandKey:_.key}):v("code16.sharp.api.show.command.singleInstance.form",{entityKey:o,commandKey:_.key}),entityKey:o,instanceId:i,query:Oe(location.search)})}function j(_){E.post(v("code16.sharp.api.show.state",{entityKey:o,instanceId:i}),{value:_}).then(b=>{C.handleCommandResponse(b.data)}).catch(b=>{var u,R;const O=(u=b.response)==null?void 0:u.data;((R=b.response)==null?void 0:R.status)===422&&Qe(O.message,{title:T("sharp::modals.state.422.title"),isError:!0})})}async function d(){await Ee(t.config.deleteConfirmationText)&&Ae.delete(v("code16.sharp.show.delete",{parentUri:v().params.parentUri,entityKey:o,instanceId:i}))}return(_,b)=>{const O=we("SharpShowField");return l(),m($e,null,{breadcrumb:s(()=>[e(re)("sharp.display_breadcrumb")?(l(),m(Me,{key:0,breadcrumb:_.breadcrumb},null,8,["breadcrumb"])):g("",!0)]),default:s(()=>[n(Ye,{breadcrumb:_.breadcrumb},null,8,["breadcrumb"]),n(Ge,{commands:e(C)},{default:s(()=>[n(Se,{class:ae(["group container pb-4 pointer-events-none data-[overflowing]:opacity-0 data-[stuck]:z-20",[{"lg:sticky lg:top-3":!L.value}]])},{default:s(()=>{var u,R;return[$("div",lt,[(u=e(t).locales)!=null&&u.length?(l(),m(e(Ce),{key:0,modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=f=>r.value=f)},{default:s(()=>[n(Re,{class:"pointer-events-auto mr-auto group-data-[stuck]:hidden"}),n(e(ze),null,{default:s(()=>[(l(!0),c(y,null,w(e(t).locales,f=>(l(),m(e(je),{key:f,value:f},{default:s(()=>[$("span",nt,k(f),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):g("",!0),$("div",it,[e(t).config.state?(l(),m(e(J),{key:0},{default:s(()=>[n(e(W),{"as-child":""},{default:s(()=>[n(e(x),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization},{default:s(()=>[n(e(Be),{variant:"outline"},{default:s(()=>{var f;return[n(M,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),B(" "+k((f=e(t).instanceStateValue)==null?void 0:f.label),1)]}),_:1})]),_:1},8,["disabled"])]),_:1}),n(e(X),null,{default:s(()=>[(l(!0),c(y,null,w(e(t).config.state.values,f=>(l(),m(e(ne),{key:f.value,"model-value":f.value===e(t).instanceState,"onUpdate:modelValue":z=>z&&j(f.value)},{default:s(()=>[n(M,{class:"mr-1.5","state-value":f},null,8,["state-value"]),$("span",ot,k(f.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):g("",!0),(R=e(t).allowedInstanceCommands)!=null&&R.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization?(l(),m(e(J),{key:1},{default:s(()=>[n(e(W),{"as-child":""},{default:s(()=>[n(e(x),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:s(()=>[B(k(e(T)("sharp::entity_list.commands.instance.label"))+" ",1),n(ie)]),_:1})]),_:1}),n(e(X),null,{default:s(()=>{var f;return[e(t).config.state&&e(t).config.state.authorization?(l(),c(y,{key:0},[n(e(Ke),null,{default:s(()=>[n(e(Fe),null,{default:s(()=>[n(e(Ve),null,{default:s(()=>[B(k(e(T)("sharp::modals.entity_state.edit.title")),1)]),_:1}),n(e(Ie),null,{default:s(()=>[n(e(Le),null,{default:s(()=>[(l(!0),c(y,null,w(e(t).config.state.values,z=>(l(),m(e(ne),{key:z.value,"model-value":z.value===e(t).instanceState,"onUpdate:modelValue":q=>q&&j(z.value)},{default:s(()=>[n(M,{class:"mr-1.5","state-value":z},null,8,["state-value"]),$("span",rt,k(z.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),n(e(se),{class:"last:hidden"})],64)):g("",!0),n(oe,{commands:e(t).allowedInstanceCommands,onSelect:A},null,8,["commands"]),e(t).authorizations.delete?(l(),c(y,{key:1},[(f=e(t).allowedInstanceCommands)!=null&&f.flat().length?(l(),m(e(se),{key:0})):g("",!0),n(e(Ue),{class:"text-destructive",onClick:d},{default:s(()=>[B(k(e(T)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):g("",!0)]}),_:1})]),_:1})):g("",!0),e(t).authorizations.update?(l(),m(e(x),{key:2,class:"h-8 pointer-events-auto",size:"sm",disabled:e(K),"as-child":""},{default:s(()=>[n(e(Te),{as:e(K)?"button":"a",href:e(t).formUrl},{default:s(()=>[B(k(a.show.config.editButtonLabel||e(T)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):g("",!0)])])]}),_:1},8,["class"]),e(t).pageAlert?(l(),c("div",dt,[n(xe,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):g("",!0),$("div",ut,[e(t).getTitle(r.value)&&e(t).layout.sections[0]&&(e(t).sectionHasField(e(t).layout.sections[0],"entityList")||e(t).layout.sections[0].title)?(l(),m(le,{key:0},{default:s(()=>[n(e(Y),null,{default:s(()=>[n(e(Z),null,{default:s(()=>[B(k(e(t).getTitle(r.value)),1)]),_:1})]),_:1})]),_:1})):g("",!0),(l(!0),c(y,null,w(e(t).layout.sections,(u,R)=>N((l(),m(Ze,{class:"min-w-0",section:u},{default:s(({collapsed:f,onCollapseToggle:z})=>{var q;return[e(t).sectionHasField(u,"entityList")?(l(!0),c(y,{key:0},w(u.columns,P=>(l(),c(y,null,[(l(!0),c(y,null,w(P.fields,H=>(l(),c(y,null,[(l(!0),c(y,null,w(H,F=>(l(),c(y,null,[e(t).fields[F.key]?(l(),m(st,{key:0,field:e(t).fields[F.key],collapsable:u.collapsable,value:null,"highlighted-instance-id":e(Q)===e(t).fields[F.key].entityListKey?e(G):null,onReordering:V=>e(p)(F.key,V),onNeedsTopbar:b[1]||(b[1]=V=>L.value=V)},null,8,["field","collapsable","highlighted-instance-id","onReordering"])):(l(),c(y,{key:1},[b[2]||(b[2]=B(" Undefined EntityList ")),$("span",ct,k(F.key),1)],64))],64))),256))],64))),256))],64))),256)):(l(),c(y,{key:1},[(q=e(t).sectionCommands(u))!=null&&q.flat().length?(l(),c("div",{key:0,class:ae(["container flex justify-end mb-4",{invisible:f}])},[n(e(J),null,{default:s(()=>[n(e(W),{"as-child":""},{default:s(()=>[n(e(x),{class:"h-8",size:"sm",variant:"outline"},{default:s(()=>[B(k(e(T)("sharp::entity_list.commands.instance.label"))+" ",1),n(ie)]),_:1})]),_:1}),n(e(X),null,{default:s(()=>[n(oe,{commands:e(t).sectionCommands(u),onSelect:A},null,8,["commands"])]),_:2},1024)]),_:2},1024)],2)):g("",!0),n(le,null,{default:s(()=>{var P;return[u.title||!R&&e(t).getTitle(r.value)||u.collapsable||(P=e(t).sectionCommands(u))!=null&&P.flat().length?(l(),m(e(Y),{key:0},{default:s(()=>[$("div",ft,[u.title||!R&&e(t).getTitle(r.value)?(l(),m(e(Z),{key:0,innerHTML:u.title||!R&&e(t).getTitle(r.value)},null,8,["innerHTML"])):g("",!0),u.collapsable?(l(),m(e(x),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:z},{default:s(()=>[n(e(ue),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):g("",!0)])]),_:2},1024)):(l(),m(e(Y),{key:1,class:"pb-0"})),N(n(e(qe),null,{default:s(()=>[$("div",mt,[(l(!0),c(y,null,w(u.columns,(H,F)=>(l(),c("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:Pe({"--size":`${H.size}`})},[n(He,{class:"gap-x-4 gap-y-6"},{default:s(()=>[(l(!0),c(y,null,w(H.fields,V=>N((l(),m(Ne,null,{default:s(()=>[(l(!0),c(y,null,w(V,U=>N((l(),m(De,{layout:U},{default:s(()=>[n(O,{field:e(t).fields[U.key],"field-layout":U,value:e(t).data[U.key],locale:r.value,collapsable:u.collapsable,"entity-key":e(o),"instance-id":e(i),"is-right-col":F===u.columns.length-1,row:V,onReordering:ce=>e(p)(U.key,ce)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[D,e(t).fieldShouldBeVisible(U,r.value)]])),256))]),_:2},1536)),[[D,e(t).fieldRowShouldBeVisible(V,r.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[D,!f]])]}),_:2},1024)],64))]}),_:2},1032,["section"])),[[D,e(t).sectionShouldBeVisible(u,r.value)]])),256))])]),_:1},8,["commands"])]),_:1})}}});export{vt as default};
