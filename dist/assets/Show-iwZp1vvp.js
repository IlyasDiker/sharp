import{d as M,ak as V,aQ as ue,o as l,A as f,q as ce,ax as fe,ay as me,r as b,aR as Z,J as ie,y as pe,az as he,aA as oe,aS as ye,aT as _e,aU as I,a as n,w as s,j as k,u as e,Q as Y,b as z,t as g,c as p,k as T,aV as re,i as _,v as be,aW as ge,aP as ve,aB as ke,aX as we,V as ee,B as $e,aY as Se,G as Ce,H as v,F as y,aJ as G,aK as O,Y as Re,aL as W,_ as x,aZ as ze,a_ as Be,a$ as Fe,b0 as Ve,b1 as Ke,b2 as te,b3 as Le,X as Ue,aC as xe,b4 as ae,R as J,b5 as Te,aM as Ie,I as Ee,b6 as se,b7 as D,S as Ae,aN as je,b8 as qe,b9 as Pe,ba as Ne,bb as H,bc as De}from"./sharp-BAUW0Lu0.js";import{a as le,b as ne,c as He,p as Qe}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-DLbdWImp.js";import{E as Ge,_ as Oe,a as X}from"./EntityList-Bsre0Het.js";import{_ as We}from"./Title.vue_vue_type_script_setup_true_lang-D96iGfd8.js";import{_ as Je}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-DxgeQmCM.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-Djk3E6Bh.js";const Xe=M({__name:"Section",props:{section:{}},setup(w){const i=V(w.section.collapsable),o=ue({collapsed:i,onCollapseToggle(){i.value=!i.value}});return(t,d)=>(l(),f("section",null,[ce(t.$slots,"default",fe(me(o)))]))}});class Ye{constructor(a,i,o){Object.assign(this,a),this.entityKey=i,this.instanceId=o}get formUrl(){const a=this.config.multiformAttribute?this.data[this.config.multiformAttribute]:null;return b().params.instanceId?b("code16.sharp.form.edit",{parentUri:Z(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey,instanceId:this.instanceId}):b("code16.sharp.form.create",{parentUri:Z(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var a;return(a=this.config.state)==null?void 0:a.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var a,i;return(i=(a=this.config.commands)==null?void 0:a.instance)==null?void 0:i.map(o=>o.filter(t=>t.authorization))}getTitle(a){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[a]:this.title:null}sectionFields(a){return a.columns.map(i=>i.fields.flat().map(o=>this.fields[o.key])).flat().filter(Boolean)}sectionHasField(a,i){return this.sectionFields(a).some(o=>o.type===i)}sectionCommands(a){return a.key?(this.config.commands[a.key]??[]).map(i=>i.filter(o=>o.authorization)):null}sectionShouldBeVisible(a,i){return a.columns.map(o=>o.fields).flat(2).some(o=>this.fieldShouldBeVisible(o,i))}fieldRowShouldBeVisible(a,i,o=this.fields,t=this.data){return a.some(d=>this.fieldShouldBeVisible(d,i,o,t))}fieldShouldBeVisible(a,i,o=this.fields,t=this.data){var B;const d=o[a.key];if(!d)return ie("app.debug");if(d.type==="entityList"||d.emptyVisible)return!0;if(d.type==="text"){const h=t[d.key];return d.localized?!!((B=h==null?void 0:h.text)!=null&&B[i]):!!(h!=null&&h.text)}if(d.type==="list"){const h=t[d.key];return(h==null?void 0:h.length)>0}return!!t[d.key]}}function Me(){const w=V({}),a=pe(()=>Object.values(w.value).some(o=>o));function i(o,t){w.value[o]=t}return{isReordering:a,onEntityListReordering:i}}const Ze={class:"flex items-center gap-x-4"},et=M({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{}},setup(w){const a=w,i=V(),o=V(a.collapsable),t=V(null),d=he(),B=oe("entityList",{reload:(r,{formModal:u})=>{K(),u.shouldReopen&&u.reopen()},refresh:(r,{formModal:u})=>{t.value=t.value.withRefreshedItems(r.items),u.shouldReopen&&u.reopen()}}),h=ye({data:null,collapsed:a.collapsable},`entityList_${a.field.key}`);h.value.data&&!a.collapsable&&$(h.value.data),!_e()&&!a.collapsable&&K();async function K(){const r=await I.get(a.field.endpointUrl,{fetchOptions:{cache:"no-store"}}).then(u=>u.data);$(r)}function $(r){t.value=new Ge(r,a.field.entityListKey,a.field.hiddenFilters,a.field.hiddenCommands),d.update(r.config.filters,r.filterValues),h.value.data=t.value.toData()}async function E(r){const u=await I.get(b("code16.sharp.api.list",{entityKey:a.field.entityListKey}),{params:r}).then(S=>S.data);$(u)}async function A(r,u){const S=await I.post(b("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:t.value.query,filterValues:d.nextValues(r,u),hiddenFilters:a.field.hiddenFilters}).then(c=>c.data);$(S)}async function Q(){const r=await I.post(b("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:a.field.hiddenFilters}).then(u=>u.data);$(r)}function j(){o.value=!o.value,h.value.collapsed=o.value,t.value||K()}return(r,u)=>(l(),f("div",{ref_key:"el",ref:i},[n(Oe,be({"entity-list":t.value,"entity-key":r.field.entityListKey,filters:e(d),commands:e(B),"show-create-button":r.field.showCreateButton,"show-reorder-button":r.field.showReorderButton,"show-search-field":r.field.showSearchField,"show-entity-state":r.field.showEntityState,collapsed:o.value,title:r.field.label,inline:"","onUpdate:query":E,onFilterChange:A,onReset:Q,onReordering:u[0]||(u[0]=S=>r.$emit("reordering",S))},r.$attrs),{"card-header":s(()=>[k("div",Ze,[n(e(Y),null,{default:s(()=>[z(g(r.field.label),1)]),_:1}),r.collapsable?(l(),p(e(T),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:s(()=>[n(e(re),{class:"w-4 h-4"})]),_:1})):_("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","collapsed","title"])],512))}}),tt={class:"flex flex-wrap justify-end gap-3"},at={class:"uppercase text-xs"},st={class:"contents lg:flex flex-wrap justify-end gap-3","data-sticky-content":""},lt={class:"truncate"},nt={class:"truncate"},it={key:0,class:"container"},ot={class:"grid gap-6 md:gap-8"},rt={class:"font-mono"},dt={class:"flex gap-4"},ut={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},_t=M({__name:"Show",props:{show:{},breadcrumb:{}},setup(w){var j;const a=w,{entityKey:i,instanceId:o}=b().params,t=new Ye(a.show,i,o),d=V((j=t.locales)==null?void 0:j[0]),{isReordering:B,onEntityListReordering:h}=Me(),K=V(!1),$=oe("show");ge("show",t);function E(r){$.send(r,{postCommand:b("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:o,commandKey:r.key}),getForm:o?b("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:o,commandKey:r.key}):b("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:r.key}),entityKey:i,instanceId:o,query:Qe(location.search)})}function A(r){I.post(b("code16.sharp.api.show.state",{entityKey:i,instanceId:o}),{value:r}).then(u=>{$.handleCommandResponse(u.data)}).catch(u=>{var c,C;const S=(c=u.response)==null?void 0:c.data;((C=u.response)==null?void 0:C.status)===422&&De(S.message,{title:x("sharp::modals.state.422.title"),isError:!0})})}async function Q(){await Te(t.config.deleteConfirmationText)&&Ie.delete(b("code16.sharp.show.delete",{parentUri:b().params.parentUri,entityKey:i,instanceId:o}))}return(r,u)=>{const S=ve("SharpShowField");return l(),p(ke,null,{breadcrumb:s(()=>[e(ie)("sharp.display_breadcrumb")?(l(),p(Je,{key:0,breadcrumb:r.breadcrumb},null,8,["breadcrumb"])):_("",!0)]),default:s(()=>[n(We,{breadcrumb:r.breadcrumb},null,8,["breadcrumb"]),n(He,{commands:e($)},{default:s(()=>[n(we,{class:ee(["group container pb-4 pointer-events-none data-[overflowing]:opacity-0 data-[stuck]:z-20",[{"lg:sticky lg:top-3":!K.value}]])},{default:s(()=>{var c,C;return[k("div",tt,[(c=e(t).locales)!=null&&c.length?(l(),p(e($e),{key:0,modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=m=>d.value=m)},{default:s(()=>[n(Se,{class:"pointer-events-auto mr-auto group-data-[stuck]:hidden"}),n(e(Ce),null,{default:s(()=>[(l(!0),f(y,null,v(e(t).locales,m=>(l(),p(e(Ee),{key:m,value:m},{default:s(()=>[k("span",at,g(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):_("",!0),k("div",st,[e(t).config.state?(l(),p(e(G),{key:0},{default:s(()=>[n(e(O),{"as-child":""},{default:s(()=>[n(e(T),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization},{default:s(()=>[n(e(Re),{variant:"outline"},{default:s(()=>{var m;return[n(X,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),z(" "+g((m=e(t).instanceStateValue)==null?void 0:m.label),1)]}),_:1})]),_:1},8,["disabled"])]),_:1}),n(e(W),null,{default:s(()=>[(l(!0),f(y,null,v(e(t).config.state.values,m=>(l(),p(e(se),{key:m.value,"model-value":m.value===e(t).instanceState,"onUpdate:modelValue":R=>R&&A(m.value)},{default:s(()=>[n(X,{class:"mr-1.5","state-value":m},null,8,["state-value"]),k("span",lt,g(m.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):_("",!0),(C=e(t).allowedInstanceCommands)!=null&&C.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization?(l(),p(e(G),{key:1},{default:s(()=>[n(e(O),{"as-child":""},{default:s(()=>[n(e(T),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:s(()=>[z(g(e(x)("sharp::entity_list.commands.instance.label"))+" ",1),n(le)]),_:1})]),_:1}),n(e(W),null,{default:s(()=>{var m;return[e(t).config.state&&e(t).config.state.authorization?(l(),f(y,{key:0},[n(e(ze),null,{default:s(()=>[n(e(Be),null,{default:s(()=>[n(e(Fe),null,{default:s(()=>[z(g(e(x)("sharp::modals.entity_state.edit.title")),1)]),_:1}),n(e(Ve),null,{default:s(()=>[n(e(Ke),null,{default:s(()=>[(l(!0),f(y,null,v(e(t).config.state.values,R=>(l(),p(e(se),{key:R.value,"model-value":R.value===e(t).instanceState,"onUpdate:modelValue":q=>q&&A(R.value)},{default:s(()=>[n(X,{class:"mr-1.5","state-value":R},null,8,["state-value"]),k("span",nt,g(R.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),n(e(te),{class:"last:hidden"})],64)):_("",!0),n(ne,{commands:e(t).allowedInstanceCommands,onSelect:E},null,8,["commands"]),e(t).authorizations.delete?(l(),f(y,{key:1},[(m=e(t).allowedInstanceCommands)!=null&&m.flat().length?(l(),p(e(te),{key:0})):_("",!0),n(e(Le),{class:"text-destructive",onClick:Q},{default:s(()=>[z(g(e(x)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):_("",!0)]}),_:1})]),_:1})):_("",!0),e(t).authorizations.update?(l(),p(e(T),{key:2,class:"h-8 pointer-events-auto",size:"sm",disabled:e(B),"as-child":""},{default:s(()=>[n(e(Ue),{as:e(B)?"button":"a",href:e(t).formUrl},{default:s(()=>[z(g(a.show.config.editButtonLabel||e(x)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):_("",!0)])])]}),_:1},8,["class"]),e(t).pageAlert?(l(),f("div",it,[n(xe,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):_("",!0),k("div",ot,[e(t).getTitle(d.value)&&e(t).layout.sections[0]&&(e(t).sectionHasField(e(t).layout.sections[0],"entityList")||e(t).layout.sections[0].title)?(l(),p(ae,{key:0},{default:s(()=>[n(e(J),null,{default:s(()=>[n(e(Y),null,{default:s(()=>[z(g(e(t).getTitle(d.value)),1)]),_:1})]),_:1})]),_:1})):_("",!0),(l(!0),f(y,null,v(e(t).layout.sections,(c,C)=>D((l(),p(Xe,{class:"min-w-0",section:c},{default:s(({collapsed:m,onCollapseToggle:R})=>{var q;return[e(t).sectionHasField(c,"entityList")?(l(!0),f(y,{key:0},v(c.columns,P=>(l(),f(y,null,[(l(!0),f(y,null,v(P.fields,N=>(l(),f(y,null,[(l(!0),f(y,null,v(N,L=>(l(),f(y,null,[e(t).fields[L.key]?(l(),p(et,{key:0,field:e(t).fields[L.key],collapsable:c.collapsable,value:null,onReordering:F=>e(h)(L.key,F),onNeedsTopbar:u[1]||(u[1]=F=>K.value=F)},null,8,["field","collapsable","onReordering"])):(l(),f(y,{key:1},[u[2]||(u[2]=z(" Undefined EntityList ")),k("span",rt,g(L.key),1)],64))],64))),256))],64))),256))],64))),256)):(l(),f(y,{key:1},[(q=e(t).sectionCommands(c))!=null&&q.flat().length?(l(),f("div",{key:0,class:ee(["container flex justify-end mb-4",{invisible:m}])},[n(e(G),null,{default:s(()=>[n(e(O),{"as-child":""},{default:s(()=>[n(e(T),{class:"h-8",size:"sm",variant:"outline"},{default:s(()=>[z(g(e(x)("sharp::entity_list.commands.instance.label"))+" ",1),n(le)]),_:1})]),_:1}),n(e(W),null,{default:s(()=>[n(ne,{commands:e(t).sectionCommands(c),onSelect:E},null,8,["commands"])]),_:2},1024)]),_:2},1024)],2)):_("",!0),n(ae,null,{default:s(()=>{var P;return[c.title||!C&&e(t).getTitle(d.value)||c.collapsable||(P=e(t).sectionCommands(c))!=null&&P.flat().length?(l(),p(e(J),{key:0},{default:s(()=>[k("div",dt,[c.title||!C&&e(t).getTitle(d.value)?(l(),p(e(Y),{key:0,innerHTML:c.title||!C&&e(t).getTitle(d.value)},null,8,["innerHTML"])):_("",!0),c.collapsable?(l(),p(e(T),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:R},{default:s(()=>[n(e(re),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):_("",!0)])]),_:2},1024)):(l(),p(e(J),{key:1,class:"pb-0"})),D(n(e(Ae),null,{default:s(()=>[k("div",ut,[(l(!0),f(y,null,v(c.columns,(N,L)=>(l(),f("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:je({"--size":`${N.size}`})},[n(qe,{class:"gap-x-4 gap-y-6"},{default:s(()=>[(l(!0),f(y,null,v(N.fields,F=>D((l(),p(Pe,null,{default:s(()=>[(l(!0),f(y,null,v(F,U=>D((l(),p(Ne,{layout:U},{default:s(()=>[n(S,{field:e(t).fields[U.key],"field-layout":U,value:e(t).data[U.key],locale:d.value,collapsable:c.collapsable,"entity-key":e(i),"instance-id":e(o),"is-right-col":L===c.columns.length-1,row:F,onReordering:de=>e(h)(U.key,de)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[H,e(t).fieldShouldBeVisible(U,d.value)]])),256))]),_:2},1536)),[[H,e(t).fieldRowShouldBeVisible(F,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[H,!m]])]}),_:2},1024)],64))]}),_:2},1032,["section"])),[[H,e(t).sectionShouldBeVisible(c,d.value)]])),256))])]),_:1},8,["commands"])]),_:1})}}});export{_t as default};
