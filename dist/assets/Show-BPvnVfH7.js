import{d as Y,ai as x,o as s,z as c,p as de,r as g,az as Z,x as ue,aA as ce,an as fe,aB as I,a as i,w as l,i as k,u as e,N as X,b as F,t as b,c as d,j as U,aC as ie,h as y,q as me,aD as he,ay as pe,ap as _e,I as ye,aE as ge,U as ee,A as be,aF as ve,E as ke,G as v,F as p,ar as G,as as O,X as we,au as P,_ as R,at as te,aG as $e,aH as Ce,aI as Se,aJ as Fe,aK as ze,aL as ae,aM as xe,W as Ke,aq as Be,S as Re,O as Q,aN as Ue,av as Ve,H as Te,aO as se,aP as M,aQ as le,aR as Ae,Q as Ie,al as Le,aS as Ee,aT as qe,aU as Ne,aV as W,aW as He}from"./sharp-BzqWd9f1.js";import{u as oe,a as ne,b as je,p as De}from"./CommandDropdownItems.vue_vue_type_script_setup_true_lang-xsMdNgi8.js";import{_ as Ge,E as Oe,a as J}from"./EntityList-CnRuVmME.js";import{_ as Pe}from"./Title.vue_vue_type_script_setup_true_lang-DnOZsG9R.js";import{_ as Qe}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-B6R-jyYj.js";import"./TemplateRenderer.vue_vue_type_script_setup_true_lang-BhoP5pFx.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-D9kp6scJ.js";const Me=Y({__name:"Section",setup(S){const a=x(!1);return(n,o)=>(s(),c("section",null,[de(n.$slots,"default",{collapsed:a.value,onToggle:t=>a.value=!t})]))}});class We{constructor(a,n,o){Object.assign(this,a),this.entityKey=n,this.instanceId=o}get formUrl(){const a=this.config.multiformAttribute?this.data[this.config.multiformAttribute]:null;return g().params.instanceId?g("code16.sharp.form.edit",{parentUri:Z(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey,instanceId:this.instanceId}):g("code16.sharp.form.create",{parentUri:Z(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var a;return(a=this.config.state)==null?void 0:a.values.find(n=>n.value===this.instanceState)}get allowedInstanceCommands(){var a,n;return(n=(a=this.config.commands)==null?void 0:a.instance)==null?void 0:n.map(o=>o.filter(t=>t.authorization))}getTitle(a){var n;if(!this.config.titleAttribute)return null;if(this.fields[this.config.titleAttribute]){const o=this.fields[this.config.titleAttribute],t=this.data[this.config.titleAttribute];return o.localized&&typeof(t==null?void 0:t.text)=="object"?(n=t==null?void 0:t.text)==null?void 0:n[a]:t==null?void 0:t.text}return null}sectionFields(a){return a.columns.map(n=>n.fields.flat().map(o=>this.fields[o.key])).flat().filter(Boolean)}sectionHasField(a,n){return this.sectionFields(a).some(o=>o.type===n)}sectionShouldBeVisible(a,n){return this.sectionFields(a).some(o=>this.fieldShouldBeVisible(o,this.data[o.key],n))}sectionCommands(a){return a.key?(this.config.commands[a.key]??[]).map(n=>n.filter(o=>o.authorization)):null}fieldShouldBeVisible(a,n,o){var t;return a.type==="entityList"||a.emptyVisible?!0:a.type==="text"?a.localized?!!((t=n==null?void 0:n.text)!=null&&t[o]):!!(n!=null&&n.text):a.type==="list"?(n==null?void 0:n.length)>0:!!n}}function Je(){const S=x({}),a=ue(()=>Object.values(S.value).some(o=>o));function n(o,t){S.value[o]=t}return{isReordering:a,onEntityListReordering:n}}const Xe={class:"flex items-center gap-x-4"},Ye=Y({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean}},setup(S){const a=S,n=x();ce();const o=x(a.collapsable),t=x(null),h=fe(),L=oe({reload:()=>{K()},refresh:r=>{t.value=t.value.withRefreshedItems(r.items)}});function z(r){t.value=new Oe(r,a.field.entityListKey,a.field.hiddenFilters,a.field.hiddenCommands),h.update(r.config.filters,r.filterValues)}async function E(r){const f=await I.get(g("code16.sharp.api.list",{entityKey:a.field.entityListKey}),{params:r}).then(_=>_.data);z(f)}async function V(r,f){const _=await I.post(g("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:t.value.query,filterValues:h.nextValues(r,f),hiddenFilters:a.field.hiddenFilters}).then(T=>T.data);z(_)}async function q(){const r=await I.post(g("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:h.defaultValues(h.rootFilters),hiddenFilters:a.field.hiddenFilters}).then(f=>f.data);z(r)}async function K(){const r=await I.get(a.field.endpointUrl).then(f=>f.data);z(r)}function D(){o.value=!o.value,t.value||K()}return a.collapsable||K(),(r,f)=>(s(),c("div",{ref_key:"el",ref:n},[i(Ge,me({"entity-list":t.value,"entity-key":r.field.entityListKey,filters:e(h),commands:e(L),"show-create-button":r.field.showCreateButton,"show-reorder-button":r.field.showReorderButton,"show-search-field":r.field.showSearchField,"show-entity-state":r.field.showEntityState,collapsed:o.value,title:r.field.label,inline:"","onUpdate:query":E,onFilterChange:V,onReset:q,onReordering:f[0]||(f[0]=_=>r.$emit("reordering",_))},r.$attrs),{"card-header":l(()=>[k("div",Xe,[i(e(X),null,{default:l(()=>[F(b(r.field.label),1)]),_:1}),r.collapsable?(s(),d(e(U),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:D},{default:l(()=>[i(e(ie),{class:"w-4 h-4"})]),_:1})):y("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","collapsed","title"])],512))}}),Ze={class:"flex flex-wrap flex-row-reverse gap-3 pointer-events-auto lg:ml-[--sticky-safe-left-offset]"},et={class:"flex-1 order-1"},tt={class:"uppercase text-xs"},at={class:"flex gap-3 lg:mr-[--sticky-safe-right-offset]"},st={class:"truncate"},lt={class:"truncate"},nt={key:0,class:"container"},it={class:"grid gap-6 md:gap-8"},ot={class:"flex gap-4"},rt={class:"flex flex-wrap gap-y-4 -mx-4"},_t=Y({__name:"Show",props:{show:{},breadcrumb:{}},setup(S){var r;const a=S,{entityKey:n,instanceId:o}=g().params,t=new We(a.show,n,o),h=x((r=t.locales)==null?void 0:r[0]),{isReordering:L,onEntityListReordering:z}=Je(),E=x(!1),V=oe();he("show",t);function q(f){V.send(f,{postCommand:g("code16.sharp.api.show.command.instance",{entityKey:n,instanceId:o,commandKey:f.key}),getForm:o?g("code16.sharp.api.show.command.instance.form",{entityKey:n,instanceId:o,commandKey:f.key}):g("code16.sharp.api.show.command.singleInstance.form",{entityKey:n,commandKey:f.key}),entityKey:n,instanceId:o,query:De(location.search)})}function K(f){I.post(g("code16.sharp.api.show.state",{entityKey:n,instanceId:o}),{value:f}).then(_=>{V.handleCommandResponse(_.data)}).catch(_=>{var u,w;const T=(u=_.response)==null?void 0:u.data;((w=_.response)==null?void 0:w.status)===422&&He(T.message,{title:R("sharp::modals.state.422.title"),isError:!0})})}async function D(){await Ue(t.config.deleteConfirmationText)&&Ve.delete(g("code16.sharp.show.delete",{parentUri:g().params.parentUri,entityKey:n,instanceId:o}))}return(f,_)=>{const T=pe("SharpShowField");return s(),d(_e,null,{breadcrumb:l(()=>[e(ye)("sharp.display_breadcrumb")?(s(),d(Qe,{key:0,breadcrumb:f.breadcrumb},null,8,["breadcrumb"])):y("",!0)]),default:l(()=>[i(Pe,{breadcrumb:f.breadcrumb},null,8,["breadcrumb"]),i(je,{commands:e(V)},{default:l(()=>[i(ge,{class:ee(["group container mb-4 pointer-events-none top-3.5 data-[stuck=true]:z-20",[{"lg:sticky":!E.value}]])},{default:l(()=>{var u,w;return[k("div",Ze,[k("div",et,[(u=e(t).locales)!=null&&u.length?(s(),d(e(be),{key:0,modelValue:h.value,"onUpdate:modelValue":_[0]||(_[0]=m=>h.value=m)},{default:l(()=>[i(ve),i(e(ke),null,{default:l(()=>[(s(!0),c(p,null,v(e(t).locales,m=>(s(),d(e(Te),{key:m,value:m},{default:l(()=>[k("span",tt,b(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):y("",!0)]),k("div",at,[e(t).config.state?(s(),d(e(G),{key:0},{default:l(()=>[i(e(O),{"as-child":""},{default:l(()=>[i(e(U),{class:"h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization},{default:l(()=>[i(e(we),{variant:"outline"},{default:l(()=>{var m;return[i(J,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),F(" "+b((m=e(t).instanceStateValue)==null?void 0:m.label),1)]}),_:1})]),_:1},8,["disabled"])]),_:1}),i(e(P),null,{default:l(()=>[(s(!0),c(p,null,v(e(t).config.state.values,m=>(s(),d(e(se),{key:m.value,"model-value":m.value===e(t).instanceState,"onUpdate:modelValue":$=>$&&K(m.value)},{default:l(()=>[i(J,{class:"mr-1.5","state-value":m},null,8,["state-value"]),k("span",st,b(m.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):y("",!0),(w=e(t).allowedInstanceCommands)!=null&&w.flat().length||e(t).authorizations.delete||e(t).config.state?(s(),d(e(G),{key:1},{default:l(()=>[i(e(O),{"as-child":""},{default:l(()=>[i(e(U),{class:"h-8",variant:"outline",size:"sm"},{default:l(()=>[F(b(e(R)("sharp::entity_list.commands.instance.label"))+" ",1),i(te)]),_:1})]),_:1}),i(e(P),null,{default:l(()=>{var m;return[e(t).config.state&&e(t).config.state.authorization?(s(),c(p,{key:0},[i(e($e),null,{default:l(()=>[i(e(Ce),null,{default:l(()=>[i(e(Se),null,{default:l(()=>[F(b(e(R)("sharp::modals.entity_state.edit.title")),1)]),_:1}),i(e(Fe),null,{default:l(()=>[i(e(ze),null,{default:l(()=>[(s(!0),c(p,null,v(e(t).config.state.values,$=>(s(),d(e(se),{key:$.value,"model-value":$.value===e(t).instanceState,"onUpdate:modelValue":N=>N&&K($.value)},{default:l(()=>[i(J,{class:"mr-1.5","state-value":$},null,8,["state-value"]),k("span",lt,b($.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),i(e(ae))],64)):y("",!0),i(ne,{commands:e(t).allowedInstanceCommands,onSelect:q},null,8,["commands"]),e(t).authorizations.delete?(s(),c(p,{key:1},[(m=e(t).allowedInstanceCommands)!=null&&m.flat().length?(s(),d(e(ae),{key:0})):y("",!0),i(e(xe),{class:"text-destructive",onClick:D},{default:l(()=>[F(b(e(R)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):y("",!0)]}),_:1})]),_:1})):y("",!0),e(t).authorizations.update?(s(),d(e(U),{key:2,class:"h-8",size:"sm",disabled:e(L),"as-child":""},{default:l(()=>[i(e(Ke),{as:e(L)?"button":"a",href:e(t).formUrl},{default:l(()=>[F(b(a.show.config.editButtonLabel||e(R)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):y("",!0)])])]}),_:1},8,["class"]),e(t).pageAlert?(s(),c("div",nt,[i(Be,{class:"mb-3","page-alert":e(t).pageAlert},null,8,["page-alert"])])):y("",!0),k("div",it,[e(t).getTitle(h.value)&&e(t).layout.sections[0]&&(e(t).sectionHasField(e(t).layout.sections[0],"entityList")||e(t).layout.sections[0].title)?(s(),d(e(Re),{key:0},{default:l(()=>[i(e(Q),null,{default:l(()=>[i(e(X),null,{default:l(()=>[F(b(e(t).getTitle(h.value)),1)]),_:1})]),_:1})]),_:1})):y("",!0),(s(!0),c(p,null,v(e(t).layout.sections,(u,w)=>M((s(),d(Me,{class:"min-w-0"},{default:l(({collapsed:m,onToggle:$})=>{var N;return[e(t).sectionHasField(u,"entityList")?(s(!0),c(p,{key:0},v(u.columns,H=>(s(),c(p,null,[(s(!0),c(p,null,v(H.fields,j=>(s(),c(p,null,[(s(!0),c(p,null,v(j,B=>(s(),c(p,null,[e(t).fields[B.key]?(s(),d(Ye,{key:0,field:e(t).fields[B.key],collapsable:u.collapsable,value:null,onReordering:A=>e(z)(B.key,A),onNeedsTopbar:_[1]||(_[1]=A=>E.value=A)},null,8,["field","collapsable","onReordering"])):(s(),d(le,{key:1,name:B.key},null,8,["name"]))],64))),256))],64))),256))],64))),256)):(s(),c(p,{key:1},[(N=e(t).sectionCommands(u))!=null&&N.flat().length?(s(),c("div",{key:0,class:ee(["container flex justify-end mb-4",{invisible:m}])},[i(e(G),null,{default:l(()=>[i(e(O),{"as-child":""},{default:l(()=>[i(e(U),{class:"h-8",size:"sm",variant:"outline"},{default:l(()=>[F(b(e(R)("sharp::entity_list.commands.instance.label"))+" ",1),i(te)]),_:1})]),_:1}),i(e(P),null,{default:l(()=>[i(ne,{commands:e(t).sectionCommands(u),onSelect:q},null,8,["commands"])]),_:2},1024)]),_:2},1024)],2)):y("",!0),i(Ae,null,{default:l(()=>{var H;return[u.title||!w&&e(t).getTitle(h.value)||u.collapsable||(H=e(t).sectionCommands(u))!=null&&H.flat().length?(s(),d(e(Q),{key:0},{default:l(()=>[k("div",ot,[u.title||!w&&e(t).getTitle(h.value)?(s(),d(e(X),{key:0,innerHTML:u.title||!w&&e(t).getTitle(h.value)},null,8,["innerHTML"])):y("",!0),u.collapsable?(s(),d(e(U),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:$},{default:l(()=>[i(e(ie),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):y("",!0)])]),_:2},1024)):(s(),d(e(Q),{key:1,class:"pb-0"})),M(i(e(Ie),null,{default:l(()=>[k("div",rt,[(s(!0),c(p,null,v(u.columns,(j,B)=>(s(),c("div",{class:"min-w-0 w-full sm:w-[calc(var(--size)/12*100%)] px-4",style:Le({"--size":`${j.size}`})},[i(Ee,{class:"gap-x-4 gap-y-6"},{default:l(()=>[(s(!0),c(p,null,v(j.fields,A=>(s(),d(qe,null,{default:l(()=>[(s(!0),c(p,null,v(A,C=>M((s(),d(Ne,{layout:C},{default:l(()=>[e(t).fields[C.key]?(s(),d(T,{key:0,field:e(t).fields[C.key],"field-layout":C,value:e(t).data[C.key],locale:h.value,collapsable:u.collapsable,"entity-key":e(n),"instance-id":e(o),"is-right-col":B===u.columns.length-1,onReordering:re=>e(z)(C.key,re)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","onReordering"])):(s(),d(le,{key:1,name:C.key},null,8,["name"]))]),_:2},1032,["layout"])),[[W,e(t).fieldShouldBeVisible(e(t).fields[C.key],e(t).data[C.key],h.value)]])),256))]),_:2},1024))),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[W,!m]])]}),_:2},1024)],64))]}),_:2},1536)),[[W,e(t).sectionShouldBeVisible(u,h.value)]])),256))])]),_:1},8,["commands"])]),_:1})}}});export{_t as default};
