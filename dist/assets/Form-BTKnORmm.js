import{d as N,r as F,aO as P,ak as p,at as C,aP as B,al as z,an as O,aQ as T,aR as j,c as y,w as n,aB as D,aM as R,o as s,u as e,J as I,i as V,a as _,j as v,V as L,b as l,t as i,k as x,X as M,A as m,_ as u,F as d}from"./sharp-NGr8F9Yr.js";import{_ as J}from"./Title.vue_vue_type_script_setup_true_lang-tYLV-bre.js";import{_ as K}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BA6cFe6u.js";const Q={class:"@container"},W={class:"flex gap-4"},Y=N({__name:"Form",props:{form:{},breadcrumb:{},errors:{},cancelUrl:{},endpointUrl:{}},setup(E){var U,H;const o=E,{entityKey:$,instanceId:k}=F().params,r=new P(o.form,$,k),h=p(!1),g=p(!1),w=p("");C(()=>r.errors,()=>{Object.keys(r.errors).length===0&&(g.value=!1)},{deep:!0});function S(){F().params;const a=()=>{h.value=!0},t=()=>{h.value=!1},c=()=>{r.errors=o.errors,g.value=!0,w.value=o.errors.error};R.post(o.endpointUrl,r.serializedData,{onStart:a,onFinish:t,onError:c})}const f=p(o.form.layout.tabs.map(a=>B(a.title)).find(a=>new URLSearchParams(location.search).get("tab")==a)??B(((H=(U=o.form.layout.tabs)==null?void 0:U[0])==null?void 0:H.title)??"")),b=z("el");return C(f,()=>{b.value&&b.value.getBoundingClientRect().top<56&&b.value.scrollIntoView();const a=new URL(location.href);a.searchParams.set("tab",f.value),R.replace({url:a.href,preserveState:!0,preserveScroll:!0})},{immediate:!0}),O(document.body,a=>{const t=a[0].target,c=t.style.minHeight?parseFloat(t.style.minHeight):0;t.offsetHeight>window.innerHeight&&t.offsetHeight>c&&(t.style.minHeight=`${t.offsetHeight}px`)}),T(()=>{document.body.style.minHeight=""}),(a,t)=>{const c=j("SharpForm");return s(),y(D,null,{breadcrumb:n(()=>[e(I)("sharp.display_breadcrumb")?(s(),y(K,{key:0,breadcrumb:a.breadcrumb},null,8,["breadcrumb"])):V("",!0)]),default:n(()=>[_(J,{breadcrumb:a.breadcrumb},null,8,["breadcrumb"]),v("div",Q,[v("div",{class:L(e(r).pageAlert?"mt-4":"mt-6 @3xl:mt-10"),ref_key:"el",ref:b},[_(c,{form:e(r),"show-error-alert":g.value,"error-alert-message":w.value,tab:f.value,"onUpdate:tab":t[0]||(t[0]=A=>f.value=A),onSubmit:S},{title:n(()=>[l(i(e(r).title),1)]),footer:n(()=>[v("div",W,[_(e(x),{variant:"outline","as-child":""},{default:n(()=>[_(e(M),{href:o.cancelUrl},{default:n(()=>[e(r).canEdit?(s(),m(d,{key:0},[l(i(e(u)("sharp::action_bar.form.cancel_button")),1)],64)):(s(),m(d,{key:1},[l(i(e(u)("sharp::action_bar.form.back_button")),1)],64))]),_:1},8,["href"])]),_:1}),e(r).canEdit?(s(),y(e(x),{key:0,style:{"min-width":"6.5em"},disabled:e(r).isUploading||h.value,onClick:S},{default:n(()=>[e(r).isUploading?(s(),m(d,{key:0},[l(i(e(u)("sharp::action_bar.form.submit_button.pending.upload")),1)],64)):e(k)||e(r).config.isSingle?(s(),m(d,{key:1},[l(i(e(u)("sharp::action_bar.form.submit_button.update")),1)],64)):(s(),m(d,{key:2},[l(i(e(u)("sharp::action_bar.form.submit_button.create")),1)],64))]),_:1},8,["disabled"])):V("",!0)])]),_:1},8,["form","show-error-alert","error-alert-message","tab"])],2)])]),_:1})}}});export{Y as default};
