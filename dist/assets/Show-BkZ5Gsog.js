import{d as Z,ai as B,o as l,z as c,p as ue,r as b,aO as M,I as ie,x as ce,aP as fe,ax as me,ay as oe,aQ as I,a as n,w as s,i as S,u as e,N as Y,b as C,t as v,c as h,j as L,aR as re,h as g,q as he,aS as pe,aN as _e,az as ye,aT as ge,U as ee,A as be,aU as ve,E as we,G as w,F as y,aH as Q,aI as G,X as ke,aJ as W,_ as x,aV as $e,aW as Se,aX as Ce,aY as ze,aZ as Fe,a_ as te,a$ as Re,W as Be,aA as Ke,b0 as ae,O as X,b1 as Ve,aK as Ue,H as xe,b2 as se,b3 as D,Q as Le,aL as Te,b4 as Ae,b5 as Ie,b6 as Ee,b7 as O,b8 as qe}from"./sharp-xia2_OGg.js";import{b as le,c as ne,d as Ne,p as je}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-DfivVmiD.js";import{_ as He,E as De,a as J}from"./EntityList-B6k0S173.js";import{_ as Oe}from"./Title.vue_vue_type_script_setup_true_lang-D_iMGXLt.js";import{_ as Pe}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiGiiDeW.js";import"./TemplateRenderer.vue_vue_type_script_setup_true_lang-BdDhOMhu.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-D37fRPTF.js";const Qe=Z({__name:"Section",setup(z){const a=B(!1);return(o,i)=>(l(),c("section",null,[ue(o.$slots,"default",{collapsed:a.value,onToggle:t=>a.value=!t})]))}});class Ge{constructor(a,o,i){Object.assign(this,a),this.entityKey=o,this.instanceId=i}get formUrl(){const a=this.config.multiformAttribute?this.data[this.config.multiformAttribute]:null;return b().params.instanceId?b("code16.sharp.form.edit",{parentUri:M(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey,instanceId:this.instanceId}):b("code16.sharp.form.create",{parentUri:M(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var a;return(a=this.config.state)==null?void 0:a.values.find(o=>o.value===this.instanceState)}get allowedInstanceCommands(){var a,o;return(o=(a=this.config.commands)==null?void 0:a.instance)==null?void 0:o.map(i=>i.filter(t=>t.authorization))}getTitle(a){var o;if(!this.config.titleAttribute)return null;if(this.fields[this.config.titleAttribute]){const i=this.fields[this.config.titleAttribute],t=this.data[this.config.titleAttribute];return i.localized&&typeof(t==null?void 0:t.text)=="object"?(o=t==null?void 0:t.text)==null?void 0:o[a]:t==null?void 0:t.text}return null}sectionFields(a){return a.columns.map(o=>o.fields.flat().map(i=>this.fields[i.key])).flat().filter(Boolean)}sectionHasField(a,o){return this.sectionFields(a).some(i=>i.type===o)}sectionCommands(a){return a.key?(this.config.commands[a.key]??[]).map(o=>o.filter(i=>i.authorization)):null}sectionShouldBeVisible(a,o){return a.columns.map(i=>i.fields).flat(2).some(i=>this.fieldShouldBeVisible(i,o))}fieldRowShouldBeVisible(a,o,i=this.fields,t=this.data){return a.some(r=>this.fieldShouldBeVisible(r,o,i,t))}fieldShouldBeVisible(a,o,i=this.fields,t=this.data){var F;const r=i[a.key];if(!r)return ie("app.debug");if(r.type==="entityList"||r.emptyVisible)return!0;if(r.type==="text"){const p=t[r.key];return r.localized?!!((F=p==null?void 0:p.text)!=null&&F[o]):!!(p!=null&&p.text)}if(r.type==="list"){const p=t[r.key];return(p==null?void 0:p.length)>0}return!!t[r.key]}}function We(){const z=B({}),a=ce(()=>Object.values(z.value).some(i=>i));function o(i,t){z.value[i]=t}return{isReordering:a,onEntityListReordering:o}}const Xe={class:"flex items-center gap-x-4"},Je=Z({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{}},setup(z){const a=z,o=B();fe();const i=B(a.collapsable),t=B(null),r=me(),F=oe("entityList",{reload:(d,{formModal:u})=>{K(),u.shouldReopen&&u.reopen()},refresh:(d,{formModal:u})=>{t.value=t.value.withRefreshedItems(d.items),u.shouldReopen&&u.reopen()}});function p(d){t.value=new De(d,a.field.entityListKey,a.field.hiddenFilters,a.field.hiddenCommands),r.update(d.config.filters,d.filterValues)}async function E(d){const u=await I.get(b("code16.sharp.api.list",{entityKey:a.field.entityListKey}),{params:d}).then(_=>_.data);p(u)}async function T(d,u){const _=await I.post(b("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:t.value.query,filterValues:r.nextValues(d,u),hiddenFilters:a.field.hiddenFilters}).then(A=>A.data);p(_)}async function q(){const d=await I.post(b("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:r.defaultValues(r.rootFilters),hiddenFilters:a.field.hiddenFilters}).then(u=>u.data);p(d)}async function K(){const d=await I.get(a.field.endpointUrl).then(u=>u.data);p(d)}function P(){i.value=!i.value,t.value||K()}return a.collapsable||K(),(d,u)=>(l(),c("div",{ref_key:"el",ref:o},[n(He,he({"entity-list":t.value,"entity-key":d.field.entityListKey,filters:e(r),commands:e(F),"show-create-button":d.field.showCreateButton,"show-reorder-button":d.field.showReorderButton,"show-search-field":d.field.showSearchField,"show-entity-state":d.field.showEntityState,collapsed:i.value,title:d.field.label,inline:"","onUpdate:query":E,onFilterChange:T,onReset:q,onReordering:u[0]||(u[0]=_=>d.$emit("reordering",_))},d.$attrs),{"card-header":s(()=>[S("div",Xe,[n(e(Y),null,{default:s(()=>[C(v(d.field.label),1)]),_:1}),d.collapsable?(l(),h(e(L),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:P},{default:s(()=>[n(e(re),{class:"w-4 h-4"})]),_:1})):g("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","collapsed","title"])],512))}}),Ye={class:"flex flex-wrap justify-end pointer-events-auto gap-3 lg:mr-[--sticky-safe-right-offset]"},Ze={class:"uppercase text-xs"},Me={class:"truncate"},et={class:"truncate"},tt={key:0,class:"container"},at={class:"grid gap-6 md:gap-8"},st={class:"font-mono"},lt={class:"flex gap-4"},nt={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},mt=Z({__name:"Show",props:{show:{},breadcrumb:{}},setup(z){var d;const a=z,{entityKey:o,instanceId:i}=b().params,t=new Ge(a.show,o,i),r=B((d=t.locales)==null?void 0:d[0]),{isReordering:F,onEntityListReordering:p}=We(),E=B(!1),T=oe("show");pe("show",t);function q(u){T.send(u,{postCommand:b("code16.sharp.api.show.command.instance",{entityKey:o,instanceId:i,commandKey:u.key}),getForm:i?b("code16.sharp.api.show.command.instance.form",{entityKey:o,instanceId:i,commandKey:u.key}):b("code16.sharp.api.show.command.singleInstance.form",{entityKey:o,commandKey:u.key}),entityKey:o,instanceId:i,query:je(location.search)})}function K(u){I.post(b("code16.sharp.api.show.state",{entityKey:o,instanceId:i}),{value:u}).then(_=>{T.handleCommandResponse(_.data)}).catch(_=>{var f,k;const A=(f=_.response)==null?void 0:f.data;((k=_.response)==null?void 0:k.status)===422&&qe(A.message,{title:x("sharp::modals.state.422.title"),isError:!0})})}async function P(){await Ve(t.config.deleteConfirmationText)&&Ue.delete(b("code16.sharp.show.delete",{parentUri:b().params.parentUri,entityKey:o,instanceId:i}))}return(u,_)=>{const A=_e("SharpShowField");return l(),h(ye,null,{breadcrumb:s(()=>[e(ie)("sharp.display_breadcrumb")?(l(),h(Pe,{key:0,breadcrumb:u.breadcrumb},null,8,["breadcrumb"])):g("",!0)]),default:s(()=>[n(Oe,{breadcrumb:u.breadcrumb},null,8,["breadcrumb"]),n(Ne,{commands:e(T)},{default:s(()=>[n(ge,{class:ee(["group container mb-4 pointer-events-none top-3 data-[stuck=true]:z-20",[{"lg:sticky":!E.value}]])},{default:s(()=>{var f,k;return[S("div",Ye,[(f=e(t).locales)!=null&&f.length?(l(),h(e(be),{key:0,modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=m=>r.value=m)},{default:s(()=>[n(ve,{class:"lg:ml-[--sticky-safe-left-offset] mr-auto"}),n(e(we),null,{default:s(()=>[(l(!0),c(y,null,w(e(t).locales,m=>(l(),h(e(xe),{key:m,value:m},{default:s(()=>[S("span",Ze,v(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):g("",!0),e(t).config.state?(l(),h(e(Q),{key:1},{default:s(()=>[n(e(G),{"as-child":""},{default:s(()=>[n(e(L),{class:"h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization},{default:s(()=>[n(e(ke),{variant:"outline"},{default:s(()=>{var m;return[n(J,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),C(" "+v((m=e(t).instanceStateValue)==null?void 0:m.label),1)]}),_:1})]),_:1},8,["disabled"])]),_:1}),n(e(W),null,{default:s(()=>[(l(!0),c(y,null,w(e(t).config.state.values,m=>(l(),h(e(se),{key:m.value,"model-value":m.value===e(t).instanceState,"onUpdate:modelValue":$=>$&&K(m.value)},{default:s(()=>[n(J,{class:"mr-1.5","state-value":m},null,8,["state-value"]),S("span",Me,v(m.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):g("",!0),(k=e(t).allowedInstanceCommands)!=null&&k.flat().length||e(t).authorizations.delete||e(t).config.state?(l(),h(e(Q),{key:2},{default:s(()=>[n(e(G),{"as-child":""},{default:s(()=>[n(e(L),{class:"h-8",variant:"outline",size:"sm"},{default:s(()=>[C(v(e(x)("sharp::entity_list.commands.instance.label"))+" ",1),n(le)]),_:1})]),_:1}),n(e(W),null,{default:s(()=>{var m;return[e(t).config.state&&e(t).config.state.authorization?(l(),c(y,{key:0},[n(e($e),null,{default:s(()=>[n(e(Se),null,{default:s(()=>[n(e(Ce),null,{default:s(()=>[C(v(e(x)("sharp::modals.entity_state.edit.title")),1)]),_:1}),n(e(ze),null,{default:s(()=>[n(e(Fe),null,{default:s(()=>[(l(!0),c(y,null,w(e(t).config.state.values,$=>(l(),h(e(se),{key:$.value,"model-value":$.value===e(t).instanceState,"onUpdate:modelValue":N=>N&&K($.value)},{default:s(()=>[n(J,{class:"mr-1.5","state-value":$},null,8,["state-value"]),S("span",et,v($.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),n(e(te),{class:"last:hidden"})],64)):g("",!0),n(ne,{commands:e(t).allowedInstanceCommands,onSelect:q},null,8,["commands"]),e(t).authorizations.delete?(l(),c(y,{key:1},[(m=e(t).allowedInstanceCommands)!=null&&m.flat().length?(l(),h(e(te),{key:0})):g("",!0),n(e(Re),{class:"text-destructive",onClick:P},{default:s(()=>[C(v(e(x)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):g("",!0)]}),_:1})]),_:1})):g("",!0),e(t).authorizations.update?(l(),h(e(L),{key:3,class:"h-8",size:"sm",disabled:e(F),"as-child":""},{default:s(()=>[n(e(Be),{as:e(F)?"button":"a",href:e(t).formUrl},{default:s(()=>[C(v(a.show.config.editButtonLabel||e(x)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):g("",!0)])]}),_:1},8,["class"]),e(t).pageAlert?(l(),c("div",tt,[n(Ke,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):g("",!0),S("div",at,[e(t).getTitle(r.value)&&e(t).layout.sections[0]&&(e(t).sectionHasField(e(t).layout.sections[0],"entityList")||e(t).layout.sections[0].title)?(l(),h(ae,{key:0},{default:s(()=>[n(e(X),null,{default:s(()=>[n(e(Y),null,{default:s(()=>[C(v(e(t).getTitle(r.value)),1)]),_:1})]),_:1})]),_:1})):g("",!0),(l(!0),c(y,null,w(e(t).layout.sections,(f,k)=>D((l(),h(Qe,{class:"min-w-0"},{default:s(({collapsed:m,onToggle:$})=>{var N;return[e(t).sectionHasField(f,"entityList")?(l(!0),c(y,{key:0},w(f.columns,j=>(l(),c(y,null,[(l(!0),c(y,null,w(j.fields,H=>(l(),c(y,null,[(l(!0),c(y,null,w(H,V=>(l(),c(y,null,[e(t).fields[V.key]?(l(),h(Je,{key:0,field:e(t).fields[V.key],collapsable:f.collapsable,value:null,onReordering:R=>e(p)(V.key,R),onNeedsTopbar:_[1]||(_[1]=R=>E.value=R)},null,8,["field","collapsable","onReordering"])):(l(),c(y,{key:1},[_[2]||(_[2]=C(" Undefined EntityList ")),S("span",st,v(V.key),1)],64))],64))),256))],64))),256))],64))),256)):(l(),c(y,{key:1},[(N=e(t).sectionCommands(f))!=null&&N.flat().length?(l(),c("div",{key:0,class:ee(["container flex justify-end mb-4",{invisible:m}])},[n(e(Q),null,{default:s(()=>[n(e(G),{"as-child":""},{default:s(()=>[n(e(L),{class:"h-8",size:"sm",variant:"outline"},{default:s(()=>[C(v(e(x)("sharp::entity_list.commands.instance.label"))+" ",1),n(le)]),_:1})]),_:1}),n(e(W),null,{default:s(()=>[n(ne,{commands:e(t).sectionCommands(f),onSelect:q},null,8,["commands"])]),_:2},1024)]),_:2},1024)],2)):g("",!0),n(ae,null,{default:s(()=>{var j;return[f.title||!k&&e(t).getTitle(r.value)||f.collapsable||(j=e(t).sectionCommands(f))!=null&&j.flat().length?(l(),h(e(X),{key:0},{default:s(()=>[S("div",lt,[f.title||!k&&e(t).getTitle(r.value)?(l(),h(e(Y),{key:0,innerHTML:f.title||!k&&e(t).getTitle(r.value)},null,8,["innerHTML"])):g("",!0),f.collapsable?(l(),h(e(L),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:$},{default:s(()=>[n(e(re),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):g("",!0)])]),_:2},1024)):(l(),h(e(X),{key:1,class:"pb-0"})),D(n(e(Le),null,{default:s(()=>[S("div",nt,[(l(!0),c(y,null,w(f.columns,(H,V)=>(l(),c("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:Te({"--size":`${H.size}`})},[n(Ae,{class:"gap-x-4 gap-y-6"},{default:s(()=>[(l(!0),c(y,null,w(H.fields,R=>D((l(),h(Ie,null,{default:s(()=>[(l(!0),c(y,null,w(R,U=>D((l(),h(Ee,{layout:U},{default:s(()=>[n(A,{field:e(t).fields[U.key],"field-layout":U,value:e(t).data[U.key],locale:r.value,collapsable:f.collapsable,"entity-key":e(o),"instance-id":e(i),"is-right-col":V===f.columns.length-1,row:R,onReordering:de=>e(p)(U.key,de)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[O,e(t).fieldShouldBeVisible(U,r.value)]])),256))]),_:2},1536)),[[O,e(t).fieldRowShouldBeVisible(R,r.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[O,!m]])]}),_:2},1024)],64))]}),_:2},1536)),[[O,e(t).sectionShouldBeVisible(f,r.value)]])),256))])]),_:1},8,["commands"])]),_:1})}}});export{mt as default};
