import{d as M,ak as V,o as l,A as f,q as ue,r as g,aQ as Z,J as ie,y as ce,az as fe,aA as oe,aR as me,aS as pe,aT as I,a as n,w as s,j as k,u as e,Q as Y,b as B,t as b,c as p,k as x,aU as re,i as y,v as he,aV as _e,aP as ye,aB as ge,aW as be,V as ee,B as ve,aX as ke,G as we,H as v,F as _,aJ as G,aK as O,Y as $e,aL as W,_ as T,aY as Se,aZ as Ce,a_ as Be,a$ as Re,b0 as ze,b1 as te,b2 as Fe,X as Ve,aC as Ke,b3 as ae,R as J,b4 as Le,aM as Ue,I as Te,b5 as se,b6 as H,S as xe,aN as Ie,b7 as Ee,b8 as Ae,b9 as je,ba as P,bb as qe}from"./sharp-C9ZKbFEU.js";import{a as le,b as ne,c as Ne,p as De}from"./DropdownChevronDown.vue_vue_type_script_setup_true_lang-BKgyV_hi.js";import{E as He,_ as Pe,a as X}from"./EntityList-P4yn45Hv.js";import{_ as Qe}from"./Title.vue_vue_type_script_setup_true_lang-Cx9HjXtV.js";import{_ as Ge}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-BN7wFx1G.js";import"./CardDescription.vue_vue_type_script_setup_true_lang-CuklEkWi.js";const Oe=M({__name:"Section",setup(R){const a=V(!1);return(i,o)=>(l(),f("section",null,[ue(i.$slots,"default",{collapsed:a.value,onToggle:t=>a.value=!t})]))}});class We{constructor(a,i,o){Object.assign(this,a),this.entityKey=i,this.instanceId=o}get formUrl(){const a=this.config.multiformAttribute?this.data[this.config.multiformAttribute]:null;return g().params.instanceId?g("code16.sharp.form.edit",{parentUri:Z(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey,instanceId:this.instanceId}):g("code16.sharp.form.create",{parentUri:Z(),entityKey:a?`${this.entityKey}:${a}`:this.entityKey})}get instanceState(){return this.config.state?this.data[this.config.state.attribute]:null}get instanceStateValue(){var a;return(a=this.config.state)==null?void 0:a.values.find(i=>i.value===this.instanceState)}get allowedInstanceCommands(){var a,i;return(i=(a=this.config.commands)==null?void 0:a.instance)==null?void 0:i.map(o=>o.filter(t=>t.authorization))}getTitle(a){var i;return this.title?typeof this.title=="object"?(i=this.title)==null?void 0:i[a]:this.title:null}sectionFields(a){return a.columns.map(i=>i.fields.flat().map(o=>this.fields[o.key])).flat().filter(Boolean)}sectionHasField(a,i){return this.sectionFields(a).some(o=>o.type===i)}sectionCommands(a){return a.key?(this.config.commands[a.key]??[]).map(i=>i.filter(o=>o.authorization)):null}sectionShouldBeVisible(a,i){return a.columns.map(o=>o.fields).flat(2).some(o=>this.fieldShouldBeVisible(o,i))}fieldRowShouldBeVisible(a,i,o=this.fields,t=this.data){return a.some(d=>this.fieldShouldBeVisible(d,i,o,t))}fieldShouldBeVisible(a,i,o=this.fields,t=this.data){var z;const d=o[a.key];if(!d)return ie("app.debug");if(d.type==="entityList"||d.emptyVisible)return!0;if(d.type==="text"){const h=t[d.key];return d.localized?!!((z=h==null?void 0:h.text)!=null&&z[i]):!!(h!=null&&h.text)}if(d.type==="list"){const h=t[d.key];return(h==null?void 0:h.length)>0}return!!t[d.key]}}function Je(){const R=V({}),a=ce(()=>Object.values(R.value).some(o=>o));function i(o,t){R.value[o]=t}return{isReordering:a,onEntityListReordering:i}}const Xe={class:"flex items-center gap-x-4"},Ye=M({__name:"EntityList",props:{field:{},value:{},fieldLayout:{},locale:{},collapsable:{type:Boolean},root:{type:Boolean},isRightCol:{type:Boolean},hideLabel:{type:Boolean},row:{}},setup(R){const a=R,i=V(),o=V(a.collapsable),t=V(null),d=fe(),z=oe("entityList",{reload:(r,{formModal:u})=>{K(),u.shouldReopen&&u.reopen()},refresh:(r,{formModal:u})=>{t.value=t.value.withRefreshedItems(r.items),u.shouldReopen&&u.reopen()}}),h=me({data:null,collapsed:a.collapsable},`entityList_${a.field.key}`);h.value.data&&!a.collapsable&&w(h.value.data),!pe()&&!a.collapsable&&K();async function K(){const r=await I.get(a.field.endpointUrl,{fetchOptions:{cache:"no-store"}}).then(u=>u.data);w(r)}function w(r){t.value=new He(r,a.field.entityListKey,a.field.hiddenFilters,a.field.hiddenCommands),d.update(r.config.filters,r.filterValues),h.value.data=t.value.toData()}async function E(r){const u=await I.get(g("code16.sharp.api.list",{entityKey:a.field.entityListKey}),{params:r}).then($=>$.data);w(u)}async function A(r,u){const $=await I.post(g("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:t.value.query,filterValues:d.nextValues(r,u),hiddenFilters:a.field.hiddenFilters}).then(c=>c.data);w($)}async function Q(){const r=await I.post(g("code16.sharp.api.list.filters.store",{entityKey:a.field.entityListKey}),{query:{...t.value.query,search:null},filterValues:d.defaultValues(d.rootFilters),hiddenFilters:a.field.hiddenFilters}).then(u=>u.data);w(r)}function j(){o.value=!o.value,h.value.collapsed=o.value,t.value||K()}return(r,u)=>(l(),f("div",{ref_key:"el",ref:i},[n(Pe,he({"entity-list":t.value,"entity-key":r.field.entityListKey,filters:e(d),commands:e(z),"show-create-button":r.field.showCreateButton,"show-reorder-button":r.field.showReorderButton,"show-search-field":r.field.showSearchField,"show-entity-state":r.field.showEntityState,collapsed:o.value,title:r.field.label,inline:"","onUpdate:query":E,onFilterChange:A,onReset:Q,onReordering:u[0]||(u[0]=$=>r.$emit("reordering",$))},r.$attrs),{"card-header":s(()=>[k("div",Xe,[n(e(Y),null,{default:s(()=>[B(b(r.field.label),1)]),_:1}),r.collapsable?(l(),p(e(x),{key:0,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5 -mr-3",onClick:j},{default:s(()=>[n(e(re),{class:"w-4 h-4"})]),_:1})):y("",!0)])]),_:1},16,["entity-list","entity-key","filters","commands","show-create-button","show-reorder-button","show-search-field","show-entity-state","collapsed","title"])],512))}}),Me={class:"flex flex-wrap justify-end gap-3"},Ze={class:"uppercase text-xs"},et={class:"contents lg:flex flex-wrap justify-end gap-3","data-sticky-content":""},tt={class:"truncate"},at={class:"truncate"},st={key:0,class:"container"},lt={class:"grid gap-6 md:gap-8"},nt={class:"font-mono"},it={class:"flex gap-4"},ot={class:"grid grid-cols-1 gap-6 @3xl/root-card:grid-cols-12"},pt=M({__name:"Show",props:{show:{},breadcrumb:{}},setup(R){var j;const a=R,{entityKey:i,instanceId:o}=g().params,t=new We(a.show,i,o),d=V((j=t.locales)==null?void 0:j[0]),{isReordering:z,onEntityListReordering:h}=Je(),K=V(!1),w=oe("show");_e("show",t);function E(r){w.send(r,{postCommand:g("code16.sharp.api.show.command.instance",{entityKey:i,instanceId:o,commandKey:r.key}),getForm:o?g("code16.sharp.api.show.command.instance.form",{entityKey:i,instanceId:o,commandKey:r.key}):g("code16.sharp.api.show.command.singleInstance.form",{entityKey:i,commandKey:r.key}),entityKey:i,instanceId:o,query:De(location.search)})}function A(r){I.post(g("code16.sharp.api.show.state",{entityKey:i,instanceId:o}),{value:r}).then(u=>{w.handleCommandResponse(u.data)}).catch(u=>{var c,S;const $=(c=u.response)==null?void 0:c.data;((S=u.response)==null?void 0:S.status)===422&&qe($.message,{title:T("sharp::modals.state.422.title"),isError:!0})})}async function Q(){await Le(t.config.deleteConfirmationText)&&Ue.delete(g("code16.sharp.show.delete",{parentUri:g().params.parentUri,entityKey:i,instanceId:o}))}return(r,u)=>{const $=ye("SharpShowField");return l(),p(ge,null,{breadcrumb:s(()=>[e(ie)("sharp.display_breadcrumb")?(l(),p(Ge,{key:0,breadcrumb:r.breadcrumb},null,8,["breadcrumb"])):y("",!0)]),default:s(()=>[n(Qe,{breadcrumb:r.breadcrumb},null,8,["breadcrumb"]),n(Ne,{commands:e(w)},{default:s(()=>[n(be,{class:ee(["group container pb-4 pointer-events-none data-[overflowing]:opacity-0 data-[stuck]:z-20",[{"lg:sticky lg:top-3":!K.value}]])},{default:s(()=>{var c,S;return[k("div",Me,[(c=e(t).locales)!=null&&c.length?(l(),p(e(ve),{key:0,modelValue:d.value,"onUpdate:modelValue":u[0]||(u[0]=m=>d.value=m)},{default:s(()=>[n(ke,{class:"pointer-events-auto mr-auto group-data-[stuck]:hidden"}),n(e(we),null,{default:s(()=>[(l(!0),f(_,null,v(e(t).locales,m=>(l(),p(e(Te),{key:m,value:m},{default:s(()=>[k("span",Ze,b(m),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])):y("",!0),k("div",et,[e(t).config.state?(l(),p(e(G),{key:0},{default:s(()=>[n(e(O),{"as-child":""},{default:s(()=>[n(e(x),{class:"pointer-events-auto h-8 -mx-2 disabled:opacity-100",variant:"ghost",size:"sm",disabled:!e(t).config.state.authorization},{default:s(()=>[n(e($e),{variant:"outline"},{default:s(()=>{var m;return[n(X,{class:"-ml-0.5 mr-1.5","state-value":e(t).instanceStateValue},null,8,["state-value"]),B(" "+b((m=e(t).instanceStateValue)==null?void 0:m.label),1)]}),_:1})]),_:1},8,["disabled"])]),_:1}),n(e(W),null,{default:s(()=>[(l(!0),f(_,null,v(e(t).config.state.values,m=>(l(),p(e(se),{key:m.value,"model-value":m.value===e(t).instanceState,"onUpdate:modelValue":C=>C&&A(m.value)},{default:s(()=>[n(X,{class:"mr-1.5","state-value":m},null,8,["state-value"]),k("span",tt,b(m.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})):y("",!0),(S=e(t).allowedInstanceCommands)!=null&&S.flat().length||e(t).authorizations.delete||e(t).config.state&&e(t).config.state.authorization?(l(),p(e(G),{key:1},{default:s(()=>[n(e(O),{"as-child":""},{default:s(()=>[n(e(x),{class:"pointer-events-auto h-8",variant:"outline",size:"sm"},{default:s(()=>[B(b(e(T)("sharp::entity_list.commands.instance.label"))+" ",1),n(le)]),_:1})]),_:1}),n(e(W),null,{default:s(()=>{var m;return[e(t).config.state&&e(t).config.state.authorization?(l(),f(_,{key:0},[n(e(Se),null,{default:s(()=>[n(e(Ce),null,{default:s(()=>[n(e(Be),null,{default:s(()=>[B(b(e(T)("sharp::modals.entity_state.edit.title")),1)]),_:1}),n(e(Re),null,{default:s(()=>[n(e(ze),null,{default:s(()=>[(l(!0),f(_,null,v(e(t).config.state.values,C=>(l(),p(e(se),{key:C.value,"model-value":C.value===e(t).instanceState,"onUpdate:modelValue":q=>q&&A(C.value)},{default:s(()=>[n(X,{class:"mr-1.5","state-value":C},null,8,["state-value"]),k("span",at,b(C.label),1)]),_:2},1032,["model-value","onUpdate:modelValue"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),n(e(te),{class:"last:hidden"})],64)):y("",!0),n(ne,{commands:e(t).allowedInstanceCommands,onSelect:E},null,8,["commands"]),e(t).authorizations.delete?(l(),f(_,{key:1},[(m=e(t).allowedInstanceCommands)!=null&&m.flat().length?(l(),p(e(te),{key:0})):y("",!0),n(e(Fe),{class:"text-destructive",onClick:Q},{default:s(()=>[B(b(e(T)("sharp::action_bar.form.delete_button")),1)]),_:1})],64)):y("",!0)]}),_:1})]),_:1})):y("",!0),e(t).authorizations.update?(l(),p(e(x),{key:2,class:"h-8 pointer-events-auto",size:"sm",disabled:e(z),"as-child":""},{default:s(()=>[n(e(Ve),{as:e(z)?"button":"a",href:e(t).formUrl},{default:s(()=>[B(b(a.show.config.editButtonLabel||e(T)("sharp::action_bar.show.edit_button")),1)]),_:1},8,["as","href"])]),_:1},8,["disabled"])):y("",!0)])])]}),_:1},8,["class"]),e(t).pageAlert?(l(),f("div",st,[n(Ke,{class:"mb-4","page-alert":e(t).pageAlert},null,8,["page-alert"])])):y("",!0),k("div",lt,[e(t).getTitle(d.value)&&e(t).layout.sections[0]&&(e(t).sectionHasField(e(t).layout.sections[0],"entityList")||e(t).layout.sections[0].title)?(l(),p(ae,{key:0},{default:s(()=>[n(e(J),null,{default:s(()=>[n(e(Y),null,{default:s(()=>[B(b(e(t).getTitle(d.value)),1)]),_:1})]),_:1})]),_:1})):y("",!0),(l(!0),f(_,null,v(e(t).layout.sections,(c,S)=>H((l(),p(Oe,{class:"min-w-0"},{default:s(({collapsed:m,onToggle:C})=>{var q;return[e(t).sectionHasField(c,"entityList")?(l(!0),f(_,{key:0},v(c.columns,N=>(l(),f(_,null,[(l(!0),f(_,null,v(N.fields,D=>(l(),f(_,null,[(l(!0),f(_,null,v(D,L=>(l(),f(_,null,[e(t).fields[L.key]?(l(),p(Ye,{key:0,field:e(t).fields[L.key],collapsable:c.collapsable,value:null,onReordering:F=>e(h)(L.key,F),onNeedsTopbar:u[1]||(u[1]=F=>K.value=F)},null,8,["field","collapsable","onReordering"])):(l(),f(_,{key:1},[u[2]||(u[2]=B(" Undefined EntityList ")),k("span",nt,b(L.key),1)],64))],64))),256))],64))),256))],64))),256)):(l(),f(_,{key:1},[(q=e(t).sectionCommands(c))!=null&&q.flat().length?(l(),f("div",{key:0,class:ee(["container flex justify-end mb-4",{invisible:m}])},[n(e(G),null,{default:s(()=>[n(e(O),{"as-child":""},{default:s(()=>[n(e(x),{class:"h-8",size:"sm",variant:"outline"},{default:s(()=>[B(b(e(T)("sharp::entity_list.commands.instance.label"))+" ",1),n(le)]),_:1})]),_:1}),n(e(W),null,{default:s(()=>[n(ne,{commands:e(t).sectionCommands(c),onSelect:E},null,8,["commands"])]),_:2},1024)]),_:2},1024)],2)):y("",!0),n(ae,null,{default:s(()=>{var N;return[c.title||!S&&e(t).getTitle(d.value)||c.collapsable||(N=e(t).sectionCommands(c))!=null&&N.flat().length?(l(),p(e(J),{key:0},{default:s(()=>[k("div",it,[c.title||!S&&e(t).getTitle(d.value)?(l(),p(e(Y),{key:0,innerHTML:c.title||!S&&e(t).getTitle(d.value)},null,8,["innerHTML"])):y("",!0),c.collapsable?(l(),p(e(x),{key:1,variant:"ghost",size:"sm",class:"w-9 p-0 -my-1.5",onClick:C},{default:s(()=>[n(e(re),{class:"w-4 h-4"})]),_:2},1032,["onClick"])):y("",!0)])]),_:2},1024)):(l(),p(e(J),{key:1,class:"pb-0"})),H(n(e(xe),null,{default:s(()=>[k("div",ot,[(l(!0),f(_,null,v(c.columns,(D,L)=>(l(),f("div",{class:"@3xl/root-card:col-[span_var(--size)]",style:Ie({"--size":`${D.size}`})},[n(Ee,{class:"gap-x-4 gap-y-6"},{default:s(()=>[(l(!0),f(_,null,v(D.fields,F=>H((l(),p(Ae,null,{default:s(()=>[(l(!0),f(_,null,v(F,U=>H((l(),p(je,{layout:U},{default:s(()=>[n($,{field:e(t).fields[U.key],"field-layout":U,value:e(t).data[U.key],locale:d.value,collapsable:c.collapsable,"entity-key":e(i),"instance-id":e(o),"is-right-col":L===c.columns.length-1,row:F,onReordering:de=>e(h)(U.key,de)},null,8,["field","field-layout","value","locale","collapsable","entity-key","instance-id","is-right-col","row","onReordering"])]),_:2},1032,["layout"])),[[P,e(t).fieldShouldBeVisible(U,d.value)]])),256))]),_:2},1536)),[[P,e(t).fieldRowShouldBeVisible(F,d.value)]])),256))]),_:2},1024)],4))),256))])]),_:2},1536),[[P,!m]])]}),_:2},1024)],64))]}),_:2},1536)),[[P,e(t).sectionShouldBeVisible(c,d.value)]])),256))])]),_:1},8,["commands"])]),_:1})}}});export{pt as default};
